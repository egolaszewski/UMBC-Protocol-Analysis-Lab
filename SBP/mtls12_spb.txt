(herald
  "Session Binding Protocol with mTLS 1.2 (uses the modified server as implemented and tested in the paper and the cookie authentication model (ca.scm) which showed the cookie stealing attack)."
  (bound 12))

(comment "CPSA 4.4.2")
(comment "All input read from mtls12_spb.scm")
(comment "Strand count bounded at 12")

(defprotocol ca basic
  (defrole clienta
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie any mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write"))) (load cookiestor any)
      (stor cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (defrole clientr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    (gen-st (cat "client store" u s cookie)))
  (defrole servera
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie data) (ppk skey) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))) (load authstor any)
      (stor authstor (cat "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie data) (ppk skey) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat "server store" s u cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (facts (neq u s))
    (gen-st (cat "server store" s u cookie)))
  (defrule clients-servers-distinct1
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct2
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct3
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct4
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "servera" z (idx 5)) (p "servera" "s" z s)
          (p "servera" "u" z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "s" z s)
          (p "serverr" "u" z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie mesg) (s u name))
      (implies
        (and (p "clientr" z (idx 5)) (p "clientr" "cookie" z cookie)
          (p "clientr" "s" z s) (p "clientr" "u" z u))
        (gen-st (cat "client store" u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "cookie" z cookie)
          (p "serverr" "u" z u) (p "serverr" "s" z s))
        (gen-st (cat "server store" s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 0)
  (unrealized (0 1) (0 3) (0 5) (0 9))
  (origs (pt-0 (0 7)) (cr (0 0)) (pms (0 2)))
  (comment "Not closed under rules"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 1)
  (parent 0)
  (unrealized (0 1) (0 3) (0 5) (0 9))
  (origs (pt-0 (0 7)) (cr (0 0)) (pms (0 2)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (precedes ((1 1) (0 1)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s spk) (privk ca)) (0 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))))
  (label 2)
  (parent 1)
  (unrealized (0 3) (0 5) (0 9))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 1 2 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 3)
  (parent 2)
  (unrealized (0 5) (0 9))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-strand serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 4)
  (parent 2)
  (unrealized (0 5) (0 9))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((1 1) (0 1)) ((2 1) (0 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 5)
  (parent 2)
  (unrealized (0 3) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((1 5) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 1 2 servera 6)
    (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 6)
  (parent 3)
  (unrealized (0 9) (1 4))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((2 1) (0 5)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc "login-successful" cookie
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 7)
  (parent 3)
  (unrealized (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms random48)
    (ppk skey) (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 5) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 2 3 servera 6)
    (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 8)
  (parent 4)
  (unrealized (0 9) (2 4))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 1) (0 5)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc "login-successful" cookie
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 9)
  (parent 4)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((1 1) (0 1)) ((2 1) (0 3)) ((3 1) (2 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 10)
  (parent 5)
  (unrealized (0 3) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 2 0 clienta 5)
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (1 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 11)
  (parent 6)
  (unrealized (0 9))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((1 5) (0 5)) ((2 1) (1 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (1 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 12)
  (parent 6)
  (unrealized (0 9) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((2 1) (0 5)) ((3 1) (2 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 13)
  (parent 7)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 3 0 clienta 5)
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (2 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 14)
  (parent 8)
  (unrealized (0 9))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms random48)
    (ppk skey) (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (2 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (2 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 15)
  (parent 8)
  (unrealized (0 9) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 1) (0 5)) ((4 1) (3 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 16)
  (parent 9)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 2) (4 0)) ((1 1) (0 1)) ((2 1) (0 3)) ((3 1) (2 0))
    ((4 1) (3 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 17)
  (parent 10)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 1 2 servera 10)
    (enc response (hash (hash pms cr sr) "server_write")) (0 9))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 18)
  (parent 11)
  (unrealized (1 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((2 1) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc response (hash (hash pms cr sr) "server_write")) (0 9))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 19)
  (parent 11)
  (unrealized (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((1 5) (0 5)) ((2 1) (1 4)) ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 20)
  (parent 12)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 2) (4 0)) ((1 1) (0 1))
    ((1 3) (0 3)) ((2 1) (0 5)) ((3 1) (2 0)) ((4 1) (3 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 21)
  (parent 13)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((2 9) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 3 servera 10)
    (enc response (hash (hash pms cr sr) "server_write")) (0 9))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 22)
  (parent 14)
  (unrealized (2 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc response (hash (hash pms cr sr) "server_write")) (0 9))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 23)
  (parent 14)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms random48)
    (ppk skey) (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (2 4)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 24)
  (parent 15)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((3 1) (0 5)) ((4 1) (3 0))
    ((5 1) (4 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 25)
  (parent 16)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p password) (cr sr random32) (pms random48)
    (ppk skey) (spk cpk akey) (c u s ca name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((0 8) (1 8))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 0 clienta 9)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (1 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 26)
  (parent 18)
  (realized)
  (shape)
  (maps
    ((0)
      ((c c) (u u) (s s) (ca ca) (p p) (cr cr) (sr sr) (pms pms)
        (spk spk) (cpk cpk)
        (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
        (cookiestor cookiestor) (request request) (response response))))
  (origs (pt-0 (0 7)) (cookie (1 5)) (pt-2 (1 7)) (cr (0 0)) (pms (0 2))
    (sr (1 1))))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)) ((2 1) (1 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (1 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 27)
  (parent 18)
  (unrealized (1 8) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((2 1) (0 9)) ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 28)
  (parent 19)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 2) (4 0)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((2 1) (1 4)) ((3 1) (2 0))
    ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 29)
  (parent 20)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((0 8) (2 8))
    ((1 1) (0 1)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5))
    ((2 9) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 3 0 clienta 9)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (2 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 30)
  (parent 22)
  (seen 26)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((2 9) (0 9))
    ((3 1) (2 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (2 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 31)
  (parent 22)
  (unrealized (2 8) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (0 9))
    ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 32)
  (parent 23)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms random48)
    (ppk skey) (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (2 4))
    ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 33)
  (parent 24)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)) ((2 1) (1 8))
    ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 34)
  (parent 27)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 2) (4 0)) ((0 4) (1 4))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((2 1) (0 9))
    ((3 1) (2 0)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 35)
  (parent 28)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((2 9) (0 9))
    ((3 1) (2 8)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 36)
  (parent 31)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((0 4) (2 4))
    ((1 1) (0 1)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5))
    ((3 1) (0 9)) ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 37)
  (parent 32)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 2) (4 0)) ((0 4) (1 4))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9))
    ((2 1) (1 8)) ((3 1) (2 0)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 38)
  (parent 34)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((0 4) (2 4))
    ((1 1) (0 1)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5))
    ((2 9) (0 9)) ((3 1) (2 8)) ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 39)
  (parent 36)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol ca basic
  (defrole clienta
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie any mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write"))) (load cookiestor any)
      (stor cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (defrole clientr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    (gen-st (cat "client store" u s cookie)))
  (defrole servera
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie data) (ppk skey) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))) (load authstor any)
      (stor authstor (cat "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie data) (ppk skey) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat "server store" s u cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (facts (neq u s))
    (gen-st (cat "server store" s u cookie)))
  (defrule clients-servers-distinct1
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct2
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct3
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct4
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "servera" z (idx 5)) (p "servera" "s" z s)
          (p "servera" "u" z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "s" z s)
          (p "serverr" "u" z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie mesg) (s u name))
      (implies
        (and (p "clientr" z (idx 5)) (p "clientr" "cookie" z cookie)
          (p "clientr" "s" z s) (p "clientr" "u" z u))
        (gen-st (cat "client store" u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "cookie" z cookie)
          (p "serverr" "u" z u) (p "serverr" "s" z s))
        (gen-st (cat "server store" s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie)))
  (label 40)
  (unrealized (0 1) (0 3) (0 5) (0 9))
  (origs (pt-0 (0 7)) (cr (0 0)) (pms (0 2)))
  (comment "Not closed under rules"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie)))
  (label 41)
  (parent 40)
  (unrealized (0 1) (0 3) (0 5) (0 9))
  (origs (pt-0 (0 7)) (cr (0 0)) (pms (0 2)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (precedes ((2 1) (0 1)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s spk) (privk ca)) (0 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))))
  (label 42)
  (parent 41)
  (unrealized (0 3) (0 5) (0 9))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((2 1) (0 1)) ((2 3) (0 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 2 3 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 43)
  (parent 42)
  (unrealized (0 5) (0 9))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((2 1) (0 1)) ((3 1) (0 1))
    ((3 3) (0 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-strand serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 44)
  (parent 42)
  (unrealized (0 5) (0 9))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((2 1) (0 1)) ((3 1) (0 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 45)
  (parent 42)
  (unrealized (0 3) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((2 1) (0 1)) ((2 3) (0 3))
    ((3 1) (0 5)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc "login-successful" cookie
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 46)
  (parent 43)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((2 1) (0 1)) ((3 1) (0 1))
    ((3 3) (0 3)) ((4 1) (0 5)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc "login-successful" cookie
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 47)
  (parent 44)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((2 1) (0 1)) ((3 1) (0 3)) ((4 1) (3 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 48)
  (parent 45)
  (unrealized (0 3) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((2 1) (0 1)) ((2 3) (0 3))
    ((3 1) (0 5)) ((4 1) (3 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 49)
  (parent 46)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((2 1) (0 1)) ((3 1) (0 1))
    ((3 3) (0 3)) ((4 1) (0 5)) ((5 1) (4 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 50)
  (parent 47)
  (unrealized (5 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 2) (5 0)) ((2 1) (0 1)) ((3 1) (0 3)) ((4 1) (3 0))
    ((5 1) (4 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 51)
  (parent 48)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 1) (0 5)) ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 52)
  (parent 49)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((0 2) (6 0)) ((2 1) (0 1))
    ((3 1) (0 1)) ((3 3) (0 3)) ((4 1) (0 5)) ((5 1) (4 0))
    ((6 1) (5 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (5 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cookie) (send cookie))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 53)
  (parent 50)
  (unrealized (6 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol ca basic
  (defrole clienta
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie any mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write"))) (load cookiestor any)
      (stor cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (defrole clientr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    (gen-st (cat "client store" u s cookie)))
  (defrole servera
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie data) (ppk skey) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))) (load authstor any)
      (stor authstor (cat "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie data) (ppk skey) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat "server store" s u cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (facts (neq u s))
    (gen-st (cat "server store" s u cookie)))
  (defrule clients-servers-distinct1
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct2
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct3
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct4
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "servera" z (idx 5)) (p "servera" "s" z s)
          (p "servera" "u" z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "s" z s)
          (p "serverr" "u" z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie mesg) (s u name))
      (implies
        (and (p "clientr" z (idx 5)) (p "clientr" "cookie" z cookie)
          (p "clientr" "s" z s) (p "clientr" "u" z u))
        (gen-st (cat "client store" u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "cookie" z cookie)
          (p "serverr" "u" z u) (p "serverr" "s" z s))
        (gen-st (cat "server store" s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))

(defskeleton ca
  (vars (cookie mesg) (response httpdata) (request httpreq)
    (cr sr random32) (pms random48) (spk cpk akey) (c s ca u name)
    (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 54)
  (unrealized (0 1) (0 3) (0 6))
  (origs (cr (0 0)) (pms (0 2)))
  (comment "Not closed under rules"))

(defskeleton ca
  (vars (cookie mesg) (response httpdata) (request httpreq)
    (cr sr random32) (pms random48) (spk cpk akey) (c s ca u name)
    (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (rule gen-st-clientr-0)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 55)
  (parent 54)
  (unrealized (0 1) (0 3) (0 4) (0 6))
  (origs (cr (0 0)) (pms (0 2)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie mesg) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (spk cpk akey)
    (c s ca u name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (precedes ((1 1) (0 1)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s spk) (privk ca)) (0 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))))
  (label 56)
  (parent 55)
  (unrealized (0 3) (0 4) (0 6))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (cookie mesg) (response httpdata) (request httpreq)
    (cr sr random32) (pms random48) (spk cpk akey) (c s ca u name)
    (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (operation encryption-test (displaced 1 2 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 57)
  (parent 56)
  (unrealized (0 4) (0 6))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie mesg) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (spk cpk akey)
    (c s ca u name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (operation encryption-test (added-strand serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 58)
  (parent 56)
  (unrealized (0 4) (0 6))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie mesg) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (spk cpk akey)
    (c s ca u name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((1 1) (0 1)) ((2 1) (0 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 59)
  (parent 56)
  (unrealized (0 3) (0 4) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (spk cpk spk-0 cpk-0 akey) (c s ca u c-0 ca-0 name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((2 7) (0 4)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (leads-to ((2 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation channel-test (added-strand clienta 8)
    (ch-msg cookiestor (cat pt "client store" u s cookie)) (0 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-0)
      (recv (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-0 sr-0
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie))))
  (label 60)
  (parent 57)
  (unrealized (0 6))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (spk cpk spk-0 cpk-0 akey)
    (c s ca u c-0 ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 7) (0 4)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (leads-to ((3 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation channel-test (added-strand clienta 8)
    (ch-msg cookiestor (cat pt "client store" u s cookie)) (0 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie))))
  (label 61)
  (parent 58)
  (unrealized (0 6))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (cookie mesg) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (spk cpk akey)
    (c s ca u name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((1 1) (0 1)) ((2 1) (0 3)) ((3 1) (2 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 62)
  (parent 59)
  (unrealized (0 3) (0 4) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any any-0 mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie-0)
    (response response) (request request-0) (p p-0) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s)
    (ca ca-0) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 7) (0 4)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 9) (0 6)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie-0 cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 1 3 servera 10)
    (enc response (hash (hash pms cr sr) "server_write")) (0 6))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie-0 (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u-0 cookie-0))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 63)
  (parent 60)
  (unrealized (2 4) (2 8))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie-0) (response response)
    (request request-0) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 7) (0 4)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 6) (0 6)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie)
    (cat "server store" s u-0 cookie-0))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-serverr-neq0 gen-st-serverr-0 trRl_clienta-at-6
    trRl_clienta-at-7)
  (operation encryption-test (displaced 1 3 serverr 7)
    (enc response (hash (hash pms cr sr) "server_write")) (0 6))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie-0))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 64)
  (parent 60)
  (unrealized (2 4) (2 5))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (spk cpk spk-0 cpk-0 akey) (c s ca u c-0 ca-0 name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((2 7) (0 4)) ((3 1) (0 6)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (leads-to ((2 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc response (hash (hash pms cr sr) "server_write")) (0 6))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-0)
      (recv (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-0 sr-0
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 65)
  (parent 60)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any any-0 mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie-0)
    (response response) (request request-0) (p p-0) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s)
    (ca ca-0) (authstor authstor))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((1 1) (0 1)) ((2 7) (0 4))
    ((3 1) (0 1)) ((3 3) (0 3)) ((3 9) (0 6)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie-0 cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 4 servera 10)
    (enc response (hash (hash pms cr sr) "server_write")) (0 6))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie-0 (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u-0 cookie-0))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 66)
  (parent 61)
  (unrealized (3 4) (3 8))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie-0) (response response)
    (request request-0) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((1 1) (0 1)) ((2 7) (0 4))
    ((3 1) (0 1)) ((3 3) (0 3)) ((3 6) (0 6)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie)
    (cat "server store" s u-0 cookie-0))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-serverr-neq0 gen-st-serverr-0 trRl_clienta-at-6
    trRl_clienta-at-7)
  (operation encryption-test (displaced 2 4 serverr 7)
    (enc response (hash (hash pms cr sr) "server_write")) (0 6))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie-0))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 67)
  (parent 61)
  (unrealized (3 4) (3 5))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (spk cpk spk-0 cpk-0 akey)
    (c s ca u c-0 ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 7) (0 4)) ((4 1) (0 6)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (leads-to ((3 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc response (hash (hash pms cr sr) "server_write")) (0 6))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 68)
  (parent 61)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie mesg) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (spk cpk akey)
    (c s ca u name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 2) (4 0)) ((1 1) (0 1)) ((2 1) (0 3)) ((3 1) (2 0))
    ((4 1) (3 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 69)
  (parent 62)
  (unrealized (0 4) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie any any-0 mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie-0)
    (response response) (request request-0) (p p-0) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s)
    (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 7) (0 4)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 9) (0 6)) ((3 1) (2 4)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie-0 cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (2 4))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie-0 (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u-0 cookie-0))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 70)
  (parent 63)
  (unrealized (2 8) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (ppk skey) (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 3 0 clientr 6)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (2 4))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 71)
  (parent 64)
  (unrealized (1 5) (2 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie-0) (response response)
    (request request-0) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 7) (0 4)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (2 4)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie)
    (cat "server store" s u-0 cookie-0))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (2 4))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie-0))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 72)
  (parent 64)
  (unrealized (2 4) (2 5) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (spk cpk spk-0 cpk-0 akey) (c s ca u c-0 ca-0 name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((2 7) (0 4)) ((3 1) (0 6)) ((4 1) (3 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (leads-to ((2 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-0)
      (recv (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-0 sr-0
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 73)
  (parent 65)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any any-0 mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie-0)
    (response response) (request request-0) (p p-0) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s)
    (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((1 1) (0 1)) ((2 7) (0 4))
    ((3 1) (0 1)) ((3 3) (0 3)) ((3 9) (0 6)) ((4 1) (3 4)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie-0 cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (3 4))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie-0 (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u-0 cookie-0))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 74)
  (parent 66)
  (unrealized (3 8) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-1) (sr sr-1) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((0 5) (3 4)) ((1 1) (0 1))
    ((2 7) (0 4)) ((3 1) (0 1)) ((3 3) (0 3)) ((3 6) (0 6)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 4 0 clientr 6)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (3 4))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 75)
  (parent 67)
  (unrealized (2 5) (3 5))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie-0) (response response)
    (request request-0) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((1 1) (0 1)) ((2 7) (0 4))
    ((3 1) (0 1)) ((3 3) (0 3)) ((3 6) (0 6)) ((4 1) (3 4)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie)
    (cat "server store" s u-0 cookie-0))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (3 4))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie-0))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 76)
  (parent 67)
  (unrealized (3 4) (3 5) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (spk cpk spk-0 cpk-0 akey)
    (c s ca u c-0 ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 7) (0 4)) ((4 1) (0 6)) ((5 1) (4 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (leads-to ((3 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 77)
  (parent 68)
  (unrealized (5 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any any-0 mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie-0)
    (response response) (request request-0) (p p-0) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s)
    (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 7) (0 4)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 9) (0 6)) ((3 1) (2 4)) ((4 1) (3 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie-0 cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie-0 (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u-0 cookie-0))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 78)
  (parent 70)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk spk-0 cpk-0 spk-1 cpk-1 akey)
    (u c ca c-0 u-0 s ca-0 c-1 ca-1 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-1) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-1) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 5) (1 5))
    ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation channel-test (added-strand servera 8)
    (ch-msg authstor (cat pt-1 "server store" s u-0 cookie)) (2 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-1 (enc (hash s spk-1) (privk ca-1))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
          (enc pms-1 spk-1)
          (enc
            (hash cr-1 sr-1
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
              (enc pms-1 spk-1)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                (enc pms-1 spk-1)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                    (enc pms-1 spk-1)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
              (enc pms-1 spk-1)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                  (enc pms-1 spk-1)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                    (enc pms-1 spk-1)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-1)))
                        (enc pms-1 spk-1)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 79)
  (parent 71)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie-0) (response response)
    (request request-0) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 7) (0 4)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (2 4)) ((4 1) (3 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie)
    (cat "server store" s u-0 cookie-0))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie-0))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 80)
  (parent 72)
  (unrealized (2 4) (2 5) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (spk cpk spk-0 cpk-0 akey) (c s ca u c-0 ca-0 name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 2) (5 0)) ((1 1) (0 1))
    ((1 3) (0 3)) ((2 7) (0 4)) ((3 1) (0 6)) ((4 1) (3 0))
    ((5 1) (4 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (leads-to ((2 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-0)
      (recv (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-0 sr-0
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 81)
  (parent 73)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie any any-0 mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie-0)
    (response response) (request request-0) (p p-0) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s)
    (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((1 1) (0 1)) ((2 7) (0 4))
    ((3 1) (0 1)) ((3 3) (0 3)) ((3 9) (0 6)) ((4 1) (3 4))
    ((5 1) (4 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie-0 cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (4 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie-0 (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u-0 cookie-0))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 82)
  (parent 74)
  (unrealized (5 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk cpk-0 spk-0 cpk-1 akey)
    (u c ca c-0 u-0 s c-1 ca-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1))
    ((3 5) (1 5)) ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation channel-test (displaced 1 4 servera 8)
    (ch-msg authstor (cat pt-1 "server store" s u-0 cookie)) (3 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 83)
  (parent 75)
  (unrealized (1 5) (3 2))
  (comment "5 in cohort - 5 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 random48) (ppk ppk-0 skey)
    (spk cpk spk-0 cpk-0 spk-1 cpk-1 akey)
    (u c ca c-0 u-0 s ca-0 c-1 ca-1 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-1) (sr sr-1) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-2)
    (sr sr-2) (pms pms-1) (ppk ppk-0) (spk spk-1) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-1) (authstor authstor))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((0 5) (3 4)) ((1 1) (0 1))
    ((2 7) (0 4)) ((3 1) (0 1)) ((3 3) (0 3)) ((3 6) (0 6))
    ((4 5) (2 5)) ((4 7) (3 5)))
  (non-orig ppk ppk-0 (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)) ((4 7) (3 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation channel-test (added-strand servera 8)
    (ch-msg authstor (cat pt-1 "server store" s u-0 cookie)) (3 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-2)
      (send (cat sr-2 s spk-1 (enc (hash s spk-1) (privk ca-1))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
          (enc pms-1 spk-1)
          (enc
            (hash cr-2 sr-2
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
              (enc pms-1 spk-1)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-2 sr-2
                (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                (enc pms-1 spk-1)
                (enc
                  (hash cr-2 sr-2
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                    (enc pms-1 spk-1)) (invk cpk-1))))
            (hash (hash pms-1 cr-2 sr-2) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-2 sr-2
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
              (enc pms-1 spk-1)
              (enc
                (hash cr-2 sr-2
                  (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                  (enc pms-1 spk-1)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-2 sr-2
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                    (enc pms-1 spk-1)
                    (enc
                      (hash cr-2 sr-2
                        (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-1)))
                        (enc pms-1 spk-1)) (invk cpk-1))))
                (hash (hash pms-1 cr-2 sr-2) "client_write"))))
          (hash (hash pms-1 cr-2 sr-2) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-2 sr-2) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-2 sr-2)))
          (hash (hash pms-1 cr-2 sr-2) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 84)
  (parent 75)
  (unrealized (2 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie-0) (response response)
    (request request-0) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((1 1) (0 1)) ((2 7) (0 4))
    ((3 1) (0 1)) ((3 3) (0 3)) ((3 6) (0 6)) ((4 1) (3 4))
    ((5 1) (4 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie)
    (cat "server store" s u-0 cookie-0))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (4 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie-0))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 85)
  (parent 76)
  (unrealized (3 4) (3 5) (5 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie any mesg) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (spk cpk spk-0 cpk-0 akey)
    (c s ca u c-0 ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (6 0)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((3 7) (0 4)) ((4 1) (0 6))
    ((5 1) (4 0)) ((6 1) (5 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (leads-to ((3 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (5 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 86)
  (parent 77)
  (unrealized (6 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie any any-0 mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie-0)
    (response response) (request request-0) (p p-0) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s)
    (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 9) (0 6)) ((3 1) (2 4))
    ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie-0 cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie-0 (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u-0 cookie-0))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 87)
  (parent 78)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk spk-0 cpk-0 spk-1 cpk-1 akey)
    (u c ca c-0 u-0 s ca-0 c-1 ca-1 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-1) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-1) (authstor authstor))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 5) (1 5))
    ((3 7) (2 5)) ((4 1) (1 5)))
  (non-orig ppk ppk-0 (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-1 (enc (hash s spk-1) (privk ca-1))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
          (enc pms-1 spk-1)
          (enc
            (hash cr-1 sr-1
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
              (enc pms-1 spk-1)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                (enc pms-1 spk-1)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                    (enc pms-1 spk-1)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
              (enc pms-1 spk-1)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                  (enc pms-1 spk-1)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                    (enc pms-1 spk-1)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-1)))
                        (enc pms-1 spk-1)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 88)
  (parent 79)
  (unrealized (1 5) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie any mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie-0) (response response)
    (request request-0) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (2 4))
    ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie)
    (cat "server store" s u-0 cookie-0))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie-0))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 89)
  (parent 80)
  (unrealized (2 4) (2 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie any any-0 mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie-0)
    (response response) (request request-0) (p p-0) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s)
    (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((0 2) (6 0)) ((1 1) (0 1))
    ((2 7) (0 4)) ((3 1) (0 1)) ((3 3) (0 3)) ((3 9) (0 6))
    ((4 1) (3 4)) ((5 1) (4 0)) ((6 1) (5 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie-0 cr sr pms)
  (gen-st (cat "client store" u s cookie))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (5 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie-0 (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u-0 cookie-0))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 90)
  (parent 82)
  (unrealized (6 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk cpk-0 spk-0 akey) (u c ca c-0 u-0 s name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk) (c c)
    (u u-0) (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 2) (3 2))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 1 clientr 3)
    (enc (hash c-1 cpk-1) (privk ca-0)) (3 2))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-1 spk-0)) (invk cpk))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk-0)) (invk cpk))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-1 spk-0)) (invk cpk))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-1 spk-0)) (invk cpk))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 91)
  (parent 83)
  (unrealized (1 1) (1 3) (1 5))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk cpk-0 spk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-0) (c c-0)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 0 clientr 3)
    (enc (hash c-1 cpk-1) (privk ca-0)) (3 2))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-0))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-0))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 92)
  (parent 83)
  (unrealized (1 5) (3 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 pms-2 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 cpk-1 spk-1 akey)
    (u c ca c-0 u-0 s c-1 ca-0 s-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-2) (sr sr-2) (pms pms-2) (spk spk-1)
    (cpk cpk-1) (c c-1) (s s-0) (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1))
    ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc (hash c-1 cpk-1) (privk ca-0)) (3 2))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-2)
      (recv (cat sr-2 s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0))))
      (send
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-2 spk-1)
          (enc
            (hash cr-2 sr-2
              (cat s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-2 spk-1)) (invk cpk-1))
          (enc
            (hash pms-2 "client finished"
              (hash cr-2 sr-2
                (cat s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-2 spk-1)
                (enc
                  (hash cr-2 sr-2
                    (cat s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-2 spk-1)) (invk cpk-1))))
            (hash (hash pms-2 cr-2 sr-2) "client_write"))))))
  (label 93)
  (parent 83)
  (unrealized (1 5) (4 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk cpk-0 spk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk spk-0) (c s)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1))
    ((3 5) (1 5)) ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 3 serverr 2)
    (enc (hash c-1 cpk-1) (privk ca-0)) (3 2))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk spk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk spk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk spk-0))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk spk-0))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 94)
  (parent 83)
  (unrealized (1 5) (3 2))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 cpk-1 akey) (u c ca c-0 u-0 s c-1 ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand serverr 2 (cr cr-2) (sr sr-2) (spk cpk-1) (s c-1)
    (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1))
    ((3 5) (1 5)) ((3 7) (2 5)) ((4 1) (3 2)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash c-1 cpk-1) (privk ca-0)) (3 2))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv cr-2)
      (send (cat sr-2 c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0))))))
  (label 95)
  (parent 83)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 random48) (ppk ppk-0 skey)
    (spk cpk spk-0 cpk-0 spk-1 cpk-1 akey)
    (u c ca c-0 u-0 s ca-0 c-1 ca-1 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-1) (sr sr-1) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-2)
    (sr sr-2) (pms pms-1) (ppk ppk-0) (spk spk-1) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-1) (authstor authstor))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((0 5) (3 4)) ((1 1) (0 1))
    ((2 7) (0 4)) ((3 1) (0 1)) ((3 3) (0 3)) ((3 6) (0 6))
    ((4 5) (2 5)) ((4 7) (3 5)) ((5 1) (2 5)))
  (non-orig ppk ppk-0 (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)) ((4 7) (3 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (2 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-2)
      (send (cat sr-2 s spk-1 (enc (hash s spk-1) (privk ca-1))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
          (enc pms-1 spk-1)
          (enc
            (hash cr-2 sr-2
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
              (enc pms-1 spk-1)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-2 sr-2
                (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                (enc pms-1 spk-1)
                (enc
                  (hash cr-2 sr-2
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                    (enc pms-1 spk-1)) (invk cpk-1))))
            (hash (hash pms-1 cr-2 sr-2) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-2 sr-2
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
              (enc pms-1 spk-1)
              (enc
                (hash cr-2 sr-2
                  (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                  (enc pms-1 spk-1)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-2 sr-2
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-1)))
                    (enc pms-1 spk-1)
                    (enc
                      (hash cr-2 sr-2
                        (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-1)))
                        (enc pms-1 spk-1)) (invk cpk-1))))
                (hash (hash pms-1 cr-2 sr-2) "client_write"))))
          (hash (hash pms-1 cr-2 sr-2) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-2 sr-2) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-2 sr-2)))
          (hash (hash pms-1 cr-2 sr-2) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 96)
  (parent 84)
  (unrealized (2 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie any mesg) (cookie-0 data) (response httpdata)
    (request request-0 httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (cpk cpk-0)
    (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie cookie) (any any) (p p) (cr cr-1)
    (sr sr-1) (pms pms-0) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie-0) (response response)
    (request request-0) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((0 2) (6 0)) ((1 1) (0 1))
    ((2 7) (0 4)) ((3 1) (0 1)) ((3 3) (0 3)) ((3 6) (0 6))
    ((4 1) (3 4)) ((5 1) (4 0)) ((6 1) (5 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cr sr pms)
  (gen-st (cat "client store" u s cookie)
    (cat "server store" s u-0 cookie-0))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (5 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt "client store" u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie-0 (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie-0))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 97)
  (parent 85)
  (unrealized (3 4) (3 5) (6 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (cpk cpk-0 spk akey) (u c ca c-0 u-0 s name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 2) (3 2))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 1) (1 1)) ((2 3) (0 3))
    ((2 6) (0 6)) ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 2 serverr 2)
    (enc (hash s spk-0) (privk ca)) (1 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk))
            (invk cpk))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-1 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk)) (invk cpk))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-1 spk)) (invk cpk))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-1 spk)) (invk cpk))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 98)
  (parent 91)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (cpk cpk-0 spk akey) (u c ca c-0 u-0 s name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 2) (3 2))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 1) (1 1)) ((3 5) (1 5)) ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 3 serverr 2)
    (enc (hash s spk-0) (privk ca)) (1 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk))
            (invk cpk))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-1 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk)) (invk cpk))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-1 spk)) (invk cpk))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-1 spk)) (invk cpk))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 99)
  (parent 91)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 akey) (u c ca c-0 u-0 s name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk) (c c)
    (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-2) (sr sr-2) (spk spk) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 2) (3 2))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)) ((4 1) (1 1)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s spk) (privk ca)) (1 1))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-1 spk-0)) (invk cpk))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk-0)) (invk cpk))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-1 spk-0)) (invk cpk))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-1 spk-0)) (invk cpk))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv cr-2) (send (cat sr-2 s spk (enc (hash s spk) (privk ca))))))
  (label 100)
  (parent 91)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk ppk-0 skey) (spk cpk akey)
    (u c ca u-0 s name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk) (c c) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-0)
    (sr sr-0) (pms pms-0) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 2) (3 2)) ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3))
    ((2 6) (0 6)) ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 1 clientr 3)
    (enc
      (hash cr-1 sr-1 (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
        (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
        (enc pms-1 spk-0)) (invk cpk-0)) (3 2))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (send
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-0 cr-0 sr-0)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 101)
  (parent 92)
  (unrealized (1 1) (1 3) (1 5))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk cpk-0 spk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-0) (c c-0)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-1) (sr sr-1) (pms pms-1) (spk spk-0)
    (cpk cpk-0) (c c-0) (s s) (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr-1 sr-1 (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
        (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
        (enc pms-1 spk-0)) (invk cpk-0)) (3 2))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-0))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-0))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))))
  (label 102)
  (parent 92)
  (unrealized (1 5) (4 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 pms-2 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 cpk-1 akey) (u c ca c-0 u-0 s c-1 ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-2) (sr sr-2) (pms pms-2) (spk spk-0)
    (cpk cpk-1) (c c-1) (s s) (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 1) (4 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 5 2 serverr 2)
    (enc (hash s-0 spk-1) (privk ca-0)) (4 1))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-2)
      (recv (cat sr-2 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-2 spk-0)
          (enc
            (hash cr-2 sr-2
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-2 spk-0)) (invk cpk-1))
          (enc
            (hash pms-2 "client finished"
              (hash cr-2 sr-2
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-2 spk-0)
                (enc
                  (hash cr-2 sr-2
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-2 spk-0)) (invk cpk-1))))
            (hash (hash pms-2 cr-2 sr-2) "client_write"))))))
  (label 103)
  (parent 93)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 pms-2 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 cpk-1 akey) (u c ca c-0 u-0 s c-1 ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-2) (sr sr-2) (pms pms-2) (spk spk-0)
    (cpk cpk-1) (c c-1) (s s) (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1))
    ((3 1) (4 1)) ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 5 3 serverr 2)
    (enc (hash s-0 spk-1) (privk ca-0)) (4 1))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-2)
      (recv (cat sr-2 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-2 spk-0)
          (enc
            (hash cr-2 sr-2
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-2 spk-0)) (invk cpk-1))
          (enc
            (hash pms-2 "client finished"
              (hash cr-2 sr-2
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-2 spk-0)
                (enc
                  (hash cr-2 sr-2
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-2 spk-0)) (invk cpk-1))))
            (hash (hash pms-2 cr-2 sr-2) "client_write"))))))
  (label 104)
  (parent 93)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 cr-3 sr-3 random32)
    (pms pms-0 pms-1 pms-2 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 cpk-1 spk-1 akey)
    (u c ca c-0 u-0 s c-1 ca-0 s-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-2) (sr sr-2) (pms pms-2) (spk spk-1)
    (cpk cpk-1) (c c-1) (s s-0) (ca ca-0))
  (defstrand serverr 2 (cr cr-3) (sr sr-3) (spk spk-1) (s s-0)
    (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1))
    ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2)) ((5 1) (4 1)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s-0 spk-1) (privk ca-0)) (4 1))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-2)
      (recv (cat sr-2 s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0))))
      (send
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-2 spk-1)
          (enc
            (hash cr-2 sr-2
              (cat s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-2 spk-1)) (invk cpk-1))
          (enc
            (hash pms-2 "client finished"
              (hash cr-2 sr-2
                (cat s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-2 spk-1)
                (enc
                  (hash cr-2 sr-2
                    (cat s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-2 spk-1)) (invk cpk-1))))
            (hash (hash pms-2 cr-2 sr-2) "client_write")))))
    ((recv cr-3)
      (send (cat sr-3 s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0))))))
  (label 105)
  (parent 93)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 cpk-1 akey) (u c ca c-0 u-0 s c-1 ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand serverr 2 (cr cr-2) (sr sr-2) (spk cpk-1) (s c-1)
    (ca ca-0))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1))
    ((3 5) (1 5)) ((3 7) (2 5)) ((4 1) (3 2)) ((5 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv cr-2)
      (send (cat sr-2 c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 106)
  (parent 95)
  (unrealized (1 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (cpk cpk-0 spk akey) (u c ca c-0 u-0 s name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 2) (3 2))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 1) (1 1)) ((2 3) (0 3))
    ((2 6) (0 6)) ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5))
    ((4 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk))
            (invk cpk))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-1 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk)) (invk cpk))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-1 spk)) (invk cpk))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-1 spk)) (invk cpk))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 107)
  (parent 98)
  (unrealized (1 5) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (cpk cpk-0 spk akey) (u c ca c-0 u-0 s name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 2) (3 2))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 1) (1 1)) ((3 5) (1 5)) ((3 7) (2 5))
    ((4 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk))
            (invk cpk))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-1 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk)) (invk cpk))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-1 spk)) (invk cpk))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-1 spk)) (invk cpk))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 108)
  (parent 99)
  (unrealized (1 5) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 akey) (u c ca c-0 u-0 s name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk) (c c)
    (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-2) (sr sr-2) (spk spk) (s s) (ca ca))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 2) (3 2))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)) ((4 1) (1 1))
    ((5 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-1 spk-0)) (invk cpk))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk-0)) (invk cpk))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-1 spk-0)) (invk cpk))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-1 spk-0)) (invk cpk))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv cr-2) (send (cat sr-2 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 109)
  (parent 100)
  (unrealized (1 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk ppk-0 skey) (spk cpk akey)
    (u c ca u-0 s name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk) (c c) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-0)
    (sr sr-0) (pms pms-0) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 2) (3 2)) ((1 7) (0 4)) ((2 1) (0 1)) ((2 1) (1 1))
    ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1)) ((3 5) (1 5))
    ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 2 serverr 2)
    (enc (hash s spk) (privk ca)) (1 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (send
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-0 cr-0 sr-0)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 110)
  (parent 101)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk ppk-0 skey) (spk cpk akey)
    (u c ca u-0 s name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk) (c c) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-0)
    (sr sr-0) (pms pms-0) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 2) (3 2)) ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3))
    ((2 6) (0 6)) ((3 1) (0 1)) ((3 1) (1 1)) ((3 5) (1 5))
    ((3 7) (2 5)))
  (non-orig ppk ppk-0 (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 3 serverr 2)
    (enc (hash s spk) (privk ca)) (1 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (send
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-0 cr-0 sr-0)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie))))
  (label 111)
  (parent 101)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48)
    (ppk ppk-0 skey) (spk cpk akey) (u c ca u-0 s name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk) (c c) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-0)
    (sr sr-0) (pms pms-0) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 2) (3 2)) ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3))
    ((2 6) (0 6)) ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5))
    ((4 1) (1 1)))
  (non-orig ppk ppk-0 (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s spk) (privk ca)) (1 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (send
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-0 cr-0 sr-0)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca))))))
  (label 112)
  (parent 101)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk cpk-0 spk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-0) (c c-0)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-1) (sr sr-1) (pms pms-1) (spk spk-0)
    (cpk cpk-0) (c c-0) (s s) (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 1) (4 1)) ((2 3) (0 3))
    ((2 6) (0 6)) ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5))
    ((4 2) (3 2)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 5 2 serverr 2)
    (enc (hash s spk-0) (privk ca-0)) (4 1))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-0))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-0))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))))
  (label 113)
  (parent 102)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk cpk-0 spk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-0) (c c-0)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-1) (sr sr-1) (pms pms-1) (spk spk-0)
    (cpk cpk-0) (c c-0) (s s) (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 1) (4 1)) ((3 5) (1 5)) ((3 7) (2 5))
    ((4 2) (3 2)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 5 3 serverr 2)
    (enc (hash s spk-0) (privk ca-0)) (4 1))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-0))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-0))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))))
  (label 114)
  (parent 102)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-0) (c c-0)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-1) (sr sr-1) (pms pms-1) (spk spk-0)
    (cpk cpk-0) (c c-0) (s s) (ca ca-0))
  (defstrand serverr 2 (cr cr-2) (sr sr-2) (spk spk-0) (s s) (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2))
    ((5 1) (4 1)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s spk-0) (privk ca-0)) (4 1))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-0))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-0))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write")))))
    ((recv cr-2)
      (send (cat sr-2 s spk-0 (enc (hash s spk-0) (privk ca-0))))))
  (label 115)
  (parent 102)
  (unrealized (1 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 pms-2 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 cpk-1 akey) (u c ca c-0 u-0 s c-1 ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-2) (sr sr-2) (pms pms-2) (spk spk-0)
    (cpk cpk-1) (c c-1) (s s) (ca ca-0))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 1) (4 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2))
    ((5 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-2)
      (recv (cat sr-2 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-2 spk-0)
          (enc
            (hash cr-2 sr-2
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-2 spk-0)) (invk cpk-1))
          (enc
            (hash pms-2 "client finished"
              (hash cr-2 sr-2
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-2 spk-0)
                (enc
                  (hash cr-2 sr-2
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-2 spk-0)) (invk cpk-1))))
            (hash (hash pms-2 cr-2 sr-2) "client_write")))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 116)
  (parent 103)
  (unrealized (1 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 pms-2 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 cpk-1 akey) (u c ca c-0 u-0 s c-1 ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-2) (sr sr-2) (pms pms-2) (spk spk-0)
    (cpk cpk-1) (c c-1) (s s) (ca ca-0))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1))
    ((3 1) (4 1)) ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2))
    ((5 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-2)
      (recv (cat sr-2 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-2 spk-0)
          (enc
            (hash cr-2 sr-2
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-2 spk-0)) (invk cpk-1))
          (enc
            (hash pms-2 "client finished"
              (hash cr-2 sr-2
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-2 spk-0)
                (enc
                  (hash cr-2 sr-2
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-2 spk-0)) (invk cpk-1))))
            (hash (hash pms-2 cr-2 sr-2) "client_write")))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 117)
  (parent 104)
  (unrealized (1 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 cr-3 sr-3 random32)
    (pms pms-0 pms-1 pms-2 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 cpk-1 spk-1 akey)
    (u c ca c-0 u-0 s c-1 ca-0 s-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-1) (c c-1)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-2) (sr sr-2) (pms pms-2) (spk spk-1)
    (cpk cpk-1) (c c-1) (s s-0) (ca ca-0))
  (defstrand serverr 2 (cr cr-3) (sr sr-3) (spk spk-1) (s s-0)
    (ca ca-0))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1))
    ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2)) ((5 1) (4 1))
    ((6 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-1))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-1))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-1))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-1 cpk-1
                          (enc (hash c-1 cpk-1) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-1))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-2)
      (recv (cat sr-2 s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0))))
      (send
        (cat (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
          (enc pms-2 spk-1)
          (enc
            (hash cr-2 sr-2
              (cat s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))
              (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
              (enc pms-2 spk-1)) (invk cpk-1))
          (enc
            (hash pms-2 "client finished"
              (hash cr-2 sr-2
                (cat s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))
                (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                (enc pms-2 spk-1)
                (enc
                  (hash cr-2 sr-2
                    (cat s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))
                    (cat c-1 cpk-1 (enc (hash c-1 cpk-1) (privk ca-0)))
                    (enc pms-2 spk-1)) (invk cpk-1))))
            (hash (hash pms-2 cr-2 sr-2) "client_write")))))
    ((recv cr-3)
      (send (cat sr-3 s-0 spk-1 (enc (hash s-0 spk-1) (privk ca-0)))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 118)
  (parent 105)
  (unrealized (1 5) (6 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk ppk-0 skey) (spk cpk akey)
    (u c ca u-0 s name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk) (c c) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-0)
    (sr sr-0) (pms pms-0) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 2) (3 2)) ((1 7) (0 4)) ((2 1) (0 1)) ((2 1) (1 1))
    ((2 3) (0 3)) ((2 6) (0 6)) ((3 1) (0 1)) ((3 5) (1 5))
    ((3 7) (2 5)) ((4 1) (1 5)))
  (non-orig ppk ppk-0 (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (send
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-0 cr-0 sr-0)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 119)
  (parent 110)
  (unrealized (1 5) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk ppk-0 skey) (spk cpk akey)
    (u c ca u-0 s name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk) (c c) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-0)
    (sr sr-0) (pms pms-0) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 2) (3 2)) ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3))
    ((2 6) (0 6)) ((3 1) (0 1)) ((3 1) (1 1)) ((3 5) (1 5))
    ((3 7) (2 5)) ((4 1) (1 5)))
  (non-orig ppk ppk-0 (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (send
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-0 cr-0 sr-0)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 120)
  (parent 111)
  (unrealized (1 5) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48)
    (ppk ppk-0 skey) (spk cpk akey) (u c ca u-0 s name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk)
    (cpk cpk) (c c) (u u-0) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-0)
    (sr sr-0) (pms pms-0) (ppk ppk-0) (spk spk) (cpk cpk) (c c) (u u-0)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 2) (3 2)) ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3))
    ((2 6) (0 6)) ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5))
    ((4 1) (1 1)) ((5 1) (1 5)))
  (non-orig ppk ppk-0 (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (send
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-0 cr-0 sr-0)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 121)
  (parent 112)
  (unrealized (1 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk cpk-0 spk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-0) (c c-0)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-1) (sr sr-1) (pms pms-1) (spk spk-0)
    (cpk cpk-0) (c c-0) (s s) (ca ca-0))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 1) (4 1)) ((2 3) (0 3))
    ((2 6) (0 6)) ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5))
    ((4 2) (3 2)) ((5 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-0))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-0))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write")))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 122)
  (parent 113)
  (unrealized (1 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (ppk ppk-0 skey) (spk cpk cpk-0 spk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-0) (c c-0)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-1) (sr sr-1) (pms pms-1) (spk spk-0)
    (cpk cpk-0) (c c-0) (s s) (ca ca-0))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 1) (4 1)) ((3 5) (1 5)) ((3 7) (2 5))
    ((4 2) (3 2)) ((5 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-0))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-0))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write")))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 123)
  (parent 114)
  (unrealized (1 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 cr-2 sr-2 random32)
    (pms pms-0 pms-1 random48) (ppk ppk-0 skey)
    (spk cpk cpk-0 spk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (ppk ppk-0) (spk spk-0) (cpk cpk-0) (c c-0)
    (u u-0) (s s) (ca ca-0) (authstor authstor))
  (defstrand clientr 3 (cr cr-1) (sr sr-1) (pms pms-1) (spk spk-0)
    (cpk cpk-0) (c c-0) (s s) (ca ca-0))
  (defstrand serverr 2 (cr cr-2) (sr sr-2) (spk spk-0) (s s) (ca ca-0))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (3 2)) ((0 5) (2 4))
    ((1 7) (0 4)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6))
    ((3 1) (0 1)) ((3 5) (1 5)) ((3 7) (2 5)) ((4 2) (3 2))
    ((5 1) (4 1)) ((6 1) (1 5)))
  (non-orig ppk ppk-0 (invk cpk-0) (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr))))
    (cat "server store" s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (1 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt-1 "server store" s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-1)
      (send (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write"))))
      (send
        (enc
          (hash pms-1 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-1 spk-0)) (invk cpk-0))
              (enc
                (hash pms-1 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-1 spk-0)) (invk cpk-0))))
                (hash (hash pms-1 cr-1 sr-1) "client_write"))))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (recv
        (enc "login" u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) "client_write")))
      (send
        (enc "login-successful"
          (enc cookie (hash ppk-0 (hash pms-1 cr-1 sr-1)))
          (hash (hash pms-1 cr-1 sr-1) "server_write")))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 "server store" s u-0 cookie)))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-1 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-1 spk-0)) (invk cpk-0))
          (enc
            (hash pms-1 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-1 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-1 spk-0)) (invk cpk-0))))
            (hash (hash pms-1 cr-1 sr-1) "client_write")))))
    ((recv cr-2)
      (send (cat sr-2 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 124)
  (parent 115)
  (unrealized (1 5) (6 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol ca basic
  (defrole clienta
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie any mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write"))) (load cookiestor any)
      (stor cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (defrole clientr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    (gen-st (cat "client store" u s cookie)))
  (defrole servera
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie data) (ppk skey) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))) (load authstor any)
      (stor authstor (cat "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie data) (ppk skey) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat "server store" s u cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (facts (neq u s))
    (gen-st (cat "server store" s u cookie)))
  (defrule clients-servers-distinct1
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct2
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct3
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct4
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "servera" z (idx 5)) (p "servera" "s" z s)
          (p "servera" "u" z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "s" z s)
          (p "serverr" "u" z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie mesg) (s u name))
      (implies
        (and (p "clientr" z (idx 5)) (p "clientr" "cookie" z cookie)
          (p "clientr" "s" z s) (p "clientr" "u" z u))
        (gen-st (cat "client store" u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "cookie" z cookie)
          (p "serverr" "u" z u) (p "serverr" "s" z s))
        (gen-st (cat "server store" s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 125)
  (unrealized (0 2))
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5)))
  (comment "Not closed under rules"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 126)
  (parent 125)
  (unrealized (0 2))
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5)))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (precedes ((1 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc (hash c cpk) (privk ca)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))))
  (label 127)
  (parent 126)
  (unrealized (0 2) (1 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk akey) (s ca u name)
    (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk spk) (c s) (u u)
    (s s) (ca ca) (authstor authstor))
  (non-orig ppk (invk spk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 1 0 serverr 2)
    (enc (hash c cpk) (privk ca)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))
            (invk spk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)) (invk spk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (enc pms spk)) (invk spk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (enc pms spk)) (invk spk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 128)
  (parent 126)
  (unrealized (0 2))
  (dead)
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5)))
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (precedes ((1 1) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash c cpk) (privk ca)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca))))))
  (label 129)
  (parent 126)
  (unrealized (0 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 0 serverr 2)
    (enc (hash s-0 spk-0) (privk ca)) (1 1))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))))
  (label 130)
  (parent 127)
  (unrealized (0 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (precedes ((1 2) (0 2)) ((2 1) (1 1)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s-0 spk-0) (privk ca)) (1 1))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))))
  (label 131)
  (parent 127)
  (unrealized (0 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 132)
  (parent 129)
  (seen 133)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 1 clientr 3)
    (enc
      (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 133)
  (parent 130)
  (realized)
  (shape)
  (maps
    ((0)
      ((c c) (s s) (ca ca) (spk spk) (cpk cpk) (cr cr) (sr sr) (pms pms)
        (cookie cookie) (u u) (p p) (ppk ppk) (any any)
        (authstor authstor) (request request))))
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5))))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 134)
  (parent 130)
  (seen 133)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (cpk spk akey)
    (c ca u s name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)) ((2 1) (1 1)))
  (non-orig ppk (invk cpk) (invk spk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 3 1 clientr 3)
    (enc
      (hash cr-1 sr-1 (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))))
  (label 135)
  (parent 131)
  (seen 133)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 136)
  (parent 131)
  (realized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s-0) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation generalization deleted (1 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0)
      (send (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 137)
  (parent 136)
  (seen 133)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(comment "Nothing left to do")

(defprotocol ca basic
  (defrole clienta
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie any mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write"))) (load cookiestor any)
      (stor cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (defrole clientr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    (gen-st (cat "client store" u s cookie)))
  (defrole servera
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie data) (ppk skey) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))) (load authstor any)
      (stor authstor (cat "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie data) (ppk skey) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat "server store" s u cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (facts (neq u s))
    (gen-st (cat "server store" s u cookie)))
  (defrule clients-servers-distinct1
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct2
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct3
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct4
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "servera" z (idx 5)) (p "servera" "s" z s)
          (p "servera" "u" z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "s" z s)
          (p "serverr" "u" z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie mesg) (s u name))
      (implies
        (and (p "clientr" z (idx 5)) (p "clientr" "cookie" z cookie)
          (p "clientr" "s" z s) (p "clientr" "u" z u))
        (gen-st (cat "client store" u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "cookie" z cookie)
          (p "serverr" "u" z u) (p "serverr" "s" z s))
        (gen-st (cat "server store" s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 138)
  (unrealized (0 2))
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5)))
  (comment "Not closed under rules"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 139)
  (parent 138)
  (unrealized (0 2))
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5)))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (precedes ((1 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc (hash c cpk) (privk ca)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))))
  (label 140)
  (parent 139)
  (unrealized (0 2) (1 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk akey) (s ca u name)
    (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk spk) (c s) (u u)
    (s s) (ca ca) (authstor authstor))
  (non-orig ppk (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 1 0 serverr 2)
    (enc (hash c cpk) (privk ca)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))
            (invk spk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)) (invk spk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (enc pms spk)) (invk spk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (enc pms spk)) (invk spk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 141)
  (parent 139)
  (unrealized (0 2))
  (dead)
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5)))
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (precedes ((1 1) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash c cpk) (privk ca)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca))))))
  (label 142)
  (parent 139)
  (unrealized (0 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 0 serverr 2)
    (enc (hash s-0 spk-0) (privk ca)) (1 1))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))))
  (label 143)
  (parent 140)
  (unrealized (0 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (precedes ((1 2) (0 2)) ((2 1) (1 1)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s-0 spk-0) (privk ca)) (1 1))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))))
  (label 144)
  (parent 140)
  (unrealized (0 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 0) (0 0)) ((2 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 145)
  (parent 142)
  (unrealized (0 4) (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 1 clientr 3)
    (enc
      (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 146)
  (parent 143)
  (unrealized (0 4) (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 147)
  (parent 143)
  (unrealized (0 4) (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (cpk spk akey)
    (c ca u s name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((2 1) (1 1)))
  (non-orig ppk (invk cpk) (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 3 1 clientr 3)
    (enc
      (hash cr-1 sr-1 (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))))
  (label 148)
  (parent 144)
  (unrealized (0 4) (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (0 0))
    ((3 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 149)
  (parent 144)
  (unrealized (0 4) (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 0) (0 0)) ((2 2) (0 2))
    ((2 4) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 3 clienta 5)
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 150)
  (parent 145)
  (unrealized (0 8) (2 3))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 0) (0 0)) ((2 2) (0 2))
    ((3 1) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 151)
  (parent 145)
  (unrealized (0 8) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((1 4) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 1 2 clienta 5)
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 152)
  (parent 146)
  (unrealized (0 8) (1 3))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((2 1) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 153)
  (parent 146)
  (unrealized (0 8) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 4) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 3 clienta 5)
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 154)
  (parent 147)
  (unrealized (0 8) (2 3))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((3 1) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 155)
  (parent 147)
  (unrealized (0 8) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 1) (2 1)) ((1 1) (2 1)) ((2 0) (0 0)) ((2 2) (0 2))
    ((2 4) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 1 3 clienta 5)
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 156)
  (parent 148)
  (unrealized (0 8) (2 3))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (cpk spk akey)
    (c ca u s name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((2 1) (1 1))
    ((3 1) (0 4)))
  (non-orig ppk (invk cpk) (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 157)
  (parent 148)
  (unrealized (0 8) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk spk-0 cpk akey) (u s c s-0 ca name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk-0)
    (cpk cpk) (c c) (u u) (s s-0) (ca ca))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (0 0))
    ((3 2) (0 2)) ((3 4) (0 4)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 3 4 clienta 5)
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 158)
  (parent 149)
  (unrealized (0 8) (3 3))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (0 0))
    ((3 2) (0 2)) ((4 1) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u p (hash (hash pms cr sr) "client_write")) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 159)
  (parent 149)
  (unrealized (0 8) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((1 1) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 4) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 3 0 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (2 3))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 160)
  (parent 150)
  (unrealized (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 0) (0 0)) ((2 2) (0 2))
    ((2 4) (0 4)) ((3 1) (2 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (2 3))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 161)
  (parent 150)
  (unrealized (0 8) (2 3) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 0) (0 0)) ((2 2) (0 2))
    ((3 1) (0 4)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 162)
  (parent 151)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((1 0) (0 0)) ((1 2) (0 2))
    ((1 4) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 0 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (1 3))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 163)
  (parent 152)
  (unrealized (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((1 4) (0 4))
    ((2 1) (1 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (1 3))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 164)
  (parent 152)
  (unrealized (0 8) (1 3) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((2 1) (0 4))
    ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (2 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 165)
  (parent 153)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((0 3) (2 3)) ((1 2) (0 2))
    ((2 0) (0 0)) ((2 2) (0 2)) ((2 4) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 3 0 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (2 3))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 166)
  (parent 154)
  (unrealized (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 4) (0 4)) ((3 1) (2 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (2 3))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 167)
  (parent 154)
  (unrealized (0 8) (2 3) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((3 1) (0 4)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 168)
  (parent 155)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((1 1) (2 1)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 4) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 3 0 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (2 3))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 169)
  (parent 156)
  (unrealized (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 1) (2 1)) ((1 1) (2 1)) ((2 0) (0 0)) ((2 2) (0 2))
    ((2 4) (0 4)) ((3 1) (2 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (2 3))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 170)
  (parent 156)
  (unrealized (0 8) (2 3) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (cpk spk akey)
    (c ca u s name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((2 1) (1 1))
    ((3 1) (0 4)) ((4 1) (3 0)))
  (non-orig ppk (invk cpk) (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 171)
  (parent 157)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk spk-0 cpk akey) (u s c s-0 ca name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk-0)
    (cpk cpk) (c c) (u u) (s s-0) (ca ca))
  (precedes ((0 1) (3 1)) ((0 3) (3 3)) ((1 2) (0 2)) ((2 1) (1 1))
    ((3 0) (0 0)) ((3 2) (0 2)) ((3 4) (0 4)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 0 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (3 3))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))))
  (label 172)
  (parent 158)
  (unrealized (0 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk spk-0 cpk akey) (u s c s-0 ca name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk-0)
    (cpk cpk) (c c) (u u) (s s-0) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (0 0))
    ((3 2) (0 2)) ((3 4) (0 4)) ((4 1) (3 3)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (3 3))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 173)
  (parent 158)
  (unrealized (0 8) (3 3) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (0 0))
    ((3 2) (0 2)) ((4 1) (0 4)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 174)
  (parent 159)
  (unrealized (5 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pt-0 pt-1 pt-2 pval) (authstor cookiestor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clienta 9 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any-0) (request request) (p p) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((0 5) (2 5)) ((1 1) (0 2))
    ((2 0) (0 0)) ((2 2) (0 2)) ((2 4) (0 4)) ((2 8) (0 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 3 clienta 9)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt-1 any-0))
      (stor cookiestor
        (cat pt-2 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 175)
  (parent 160)
  (seen 179)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((1 1) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 4) (0 4)) ((3 1) (0 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 176)
  (parent 160)
  (unrealized (0 8) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 0) (0 0)) ((2 2) (0 2))
    ((2 4) (0 4)) ((3 1) (2 3)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 177)
  (parent 161)
  (unrealized (2 3) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 0) (0 0)) ((2 2) (0 2))
    ((2 2) (5 0)) ((3 1) (0 4)) ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 178)
  (parent 162)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pt-0 pt-1 pt-2 pval) (authstor cookiestor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clienta 9 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any-0) (request request) (p p) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((0 5) (1 5)) ((1 0) (0 0))
    ((1 2) (0 2)) ((1 4) (0 4)) ((1 8) (0 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 1 2 clienta 9)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt-1 any-0))
      (stor cookiestor
        (cat pt-2 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 179)
  (parent 163)
  (realized)
  (shape)
  (maps
    ((0)
      ((c c) (s s) (ca ca) (spk spk) (cpk cpk) (cr cr) (sr sr) (pms pms)
        (cookie cookie) (u u) (p p) (ppk ppk) (any any)
        (authstor authstor) (request request))))
  (origs (pt-2 (1 7)) (pt-0 (0 7)) (sr (0 1)) (cookie (0 5)) (cr (1 0))
    (pms (1 2))))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((1 0) (0 0)) ((1 2) (0 2))
    ((1 4) (0 4)) ((2 1) (0 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 180)
  (parent 163)
  (unrealized (0 8) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((1 4) (0 4))
    ((2 1) (1 3)) ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (2 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 181)
  (parent 164)
  (unrealized (1 3) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((1 2) (4 0))
    ((2 1) (0 4)) ((3 1) (2 0)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 182)
  (parent 165)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pt-1 pt-2 pval)
    (authstor cookiestor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clienta 9 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any-0) (request request) (p p) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((0 3) (2 3)) ((0 5) (2 5))
    ((1 2) (0 2)) ((2 0) (0 0)) ((2 2) (0 2)) ((2 4) (0 4))
    ((2 8) (0 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 3 clienta 9)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt-1 any-0))
      (stor cookiestor
        (cat pt-2 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 183)
  (parent 166)
  (seen 179)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((0 3) (2 3)) ((1 2) (0 2))
    ((2 0) (0 0)) ((2 2) (0 2)) ((2 4) (0 4)) ((3 1) (0 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 184)
  (parent 166)
  (unrealized (0 8) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 4) (0 4)) ((3 1) (2 3)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 185)
  (parent 167)
  (unrealized (2 3) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (c s ca u name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 2) (5 0)) ((3 1) (0 4)) ((4 1) (3 0))
    ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 186)
  (parent 168)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pt-0 pt-1 pt-2 pval) (authstor cookiestor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 9 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any-0) (request request) (p p) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((0 5) (2 5)) ((1 1) (2 1))
    ((2 0) (0 0)) ((2 2) (0 2)) ((2 4) (0 4)) ((2 8) (0 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 3 clienta 9)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt-1 any-0))
      (stor cookiestor
        (cat pt-2 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 187)
  (parent 169)
  (seen 179)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((1 1) (2 1)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 4) (0 4)) ((3 1) (0 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 188)
  (parent 169)
  (unrealized (0 8) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 1) (2 1)) ((1 1) (2 1)) ((2 0) (0 0)) ((2 2) (0 2))
    ((2 4) (0 4)) ((3 1) (2 3)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 189)
  (parent 170)
  (unrealized (2 3) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (cpk spk akey)
    (c ca u s name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((1 2) (5 0))
    ((2 1) (1 1)) ((3 1) (0 4)) ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk cpk) (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 190)
  (parent 171)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk spk-0 cpk akey) (s c u s-0 ca name) (pt pt-0 pt-1 pt-2 pval)
    (authstor cookiestor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (defstrand clienta 9 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any-0) (request request) (p p) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk) (c c) (u u) (s s-0) (ca ca)
    (cookiestor cookiestor))
  (precedes ((0 1) (3 1)) ((0 3) (3 3)) ((0 5) (3 5)) ((1 2) (0 2))
    ((2 1) (1 1)) ((3 0) (0 0)) ((3 2) (0 2)) ((3 4) (0 4))
    ((3 8) (0 8)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 3 4 clienta 9)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt-1 any-0))
      (stor cookiestor
        (cat pt-2 "client store" u s-0
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 191)
  (parent 172)
  (realized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk spk-0 cpk akey) (u s c s-0 ca name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk-0)
    (cpk cpk) (c c) (u u) (s s-0) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 1) (3 1)) ((0 3) (3 3)) ((1 2) (0 2)) ((2 1) (1 1))
    ((3 0) (0 0)) ((3 2) (0 2)) ((3 4) (0 4)) ((4 1) (0 8)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie (hash ppk (hash pms cr sr))) request
      (hash (hash pms cr sr) "client_write")) (0 8))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 192)
  (parent 172)
  (unrealized (0 8) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk spk-0 cpk akey) (u s c s-0 ca name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk-0)
    (cpk cpk) (c c) (u u) (s s-0) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (0 0))
    ((3 2) (0 2)) ((3 4) (0 4)) ((4 1) (3 3)) ((5 1) (4 0)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (4 0))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 193)
  (parent 173)
  (unrealized (3 3) (5 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (0 0))
    ((3 2) (0 2)) ((3 2) (6 0)) ((4 1) (0 4)) ((5 1) (4 0))
    ((6 1) (5 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (5 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 194)
  (parent 174)
  (unrealized (6 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((1 1) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 4) (0 4)) ((3 1) (0 8)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 195)
  (parent 176)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 0) (0 0)) ((2 2) (0 2))
    ((2 2) (5 0)) ((2 4) (0 4)) ((3 1) (2 3)) ((4 1) (3 0))
    ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 196)
  (parent 177)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((1 0) (0 0)) ((1 2) (0 2))
    ((1 4) (0 4)) ((2 1) (0 8)) ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (2 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 197)
  (parent 180)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (1 1)) ((1 0) (0 0)) ((1 2) (0 2)) ((1 2) (4 0))
    ((1 4) (0 4)) ((2 1) (1 3)) ((3 1) (2 0)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 198)
  (parent 181)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((0 3) (2 3)) ((1 2) (0 2))
    ((2 0) (0 0)) ((2 2) (0 2)) ((2 4) (0 4)) ((3 1) (0 8))
    ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 199)
  (parent 184)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 2) (5 0)) ((2 4) (0 4)) ((3 1) (2 3))
    ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 200)
  (parent 185)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((1 1) (2 1)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 4) (0 4)) ((3 1) (0 8)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 201)
  (parent 188)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (2 1)) ((1 1) (2 1)) ((2 0) (0 0)) ((2 2) (0 2))
    ((2 2) (5 0)) ((2 4) (0 4)) ((3 1) (2 3)) ((4 1) (3 0))
    ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 202)
  (parent 189)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk spk-0 cpk akey) (s c u s-0 ca name) (pt pt-0 pt-1 pt-2 pval)
    (authstor cookiestor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 9 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any-0) (request request) (p p) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk) (c c) (u u) (s s-0) (ca ca)
    (cookiestor cookiestor))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((0 5) (2 5)) ((1 1) (0 2))
    ((2 0) (0 0)) ((2 2) (0 2)) ((2 4) (0 4)) ((2 8) (0 8)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation generalization deleted (1 0))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt-1 any-0))
      (stor cookiestor
        (cat pt-2 "client store" u s-0
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))))
  (label 203)
  (parent 191)
  (seen 179)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk spk-0 cpk akey) (u s c s-0 ca name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk-0)
    (cpk cpk) (c c) (u u) (s s-0) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 1) (3 1)) ((0 3) (3 3)) ((1 2) (0 2)) ((2 1) (1 1))
    ((3 0) (0 0)) ((3 2) (0 2)) ((3 4) (0 4)) ((4 1) (0 8))
    ((5 1) (4 0)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (4 0))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 204)
  (parent 192)
  (unrealized (5 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk spk-0 cpk akey) (u s c s-0 ca name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk-0)
    (cpk cpk) (c c) (u u) (s s-0) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 0) (0 0))
    ((3 2) (0 2)) ((3 2) (6 0)) ((3 4) (0 4)) ((4 1) (3 3))
    ((5 1) (4 0)) ((6 1) (5 0)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (5 0))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 205)
  (parent 193)
  (unrealized (6 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((1 1) (0 2)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 2) (5 0)) ((2 4) (0 4)) ((3 1) (0 8))
    ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 206)
  (parent 195)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (1 1)) ((0 3) (1 3)) ((1 0) (0 0)) ((1 2) (0 2))
    ((1 2) (4 0)) ((1 4) (0 4)) ((2 1) (0 8)) ((3 1) (2 0))
    ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 207)
  (parent 197)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((0 3) (2 3)) ((1 2) (0 2))
    ((2 0) (0 0)) ((2 2) (0 2)) ((2 2) (5 0)) ((2 4) (0 4))
    ((3 1) (0 8)) ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 208)
  (parent 199)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (u c s ca name) (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (2 1)) ((0 3) (2 3)) ((1 1) (2 1)) ((2 0) (0 0))
    ((2 2) (0 2)) ((2 2) (5 0)) ((2 4) (0 4)) ((3 1) (0 8))
    ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 209)
  (parent 201)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk spk-0 cpk akey) (u s c s-0 ca name) (pt pt-0 pval)
    (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (ppk ppk) (spk spk-0) (cpk cpk) (c c)
    (u u) (s s-0) (ca ca) (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk) (s s) (ca ca))
  (defstrand clienta 5 (p p) (cr cr) (sr sr) (pms pms) (spk spk-0)
    (cpk cpk) (c c) (u u) (s s-0) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 1) (3 1)) ((0 3) (3 3)) ((1 2) (0 2)) ((2 1) (1 1))
    ((3 0) (0 0)) ((3 2) (0 2)) ((3 2) (6 0)) ((3 4) (0 4))
    ((4 1) (0 8)) ((5 1) (4 0)) ((6 1) (5 0)))
  (non-orig ppk (invk spk-0) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s-0))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (5 0))
  (traces
    ((recv cr)
      (send (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 "server store" s-0 u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1) (send (cat sr-1 s spk (enc (hash s spk) (privk ca)))))
    ((send cr)
      (recv (cat sr s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
          (enc
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk-0)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s-0 spk-0
                          (enc (hash s-0 spk-0) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk-0)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 210)
  (parent 204)
  (unrealized (6 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol ca basic
  (defrole clienta
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie any mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write"))) (load cookiestor any)
      (stor cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (defrole clientr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    (gen-st (cat "client store" u s cookie)))
  (defrole servera
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie data) (ppk skey) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))) (load authstor any)
      (stor authstor (cat "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie data) (ppk skey) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat "server store" s u cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (facts (neq u s))
    (gen-st (cat "server store" s u cookie)))
  (defrule clients-servers-distinct1
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct2
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct3
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct4
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "servera" z (idx 5)) (p "servera" "s" z s)
          (p "servera" "u" z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "s" z s)
          (p "serverr" "u" z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie mesg) (s u name))
      (implies
        (and (p "clientr" z (idx 5)) (p "clientr" "cookie" z cookie)
          (p "clientr" "s" z s) (p "clientr" "u" z u))
        (gen-st (cat "client store" u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "cookie" z cookie)
          (p "serverr" "u" z u) (p "serverr" "s" z s))
        (gen-st (cat "server store" s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr random32) (pms random48)
    (ppk skey) (spk cpk akey) (c s ca u name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie))))
  (label 211)
  (unrealized (0 2) (0 4))
  (origs (sr (0 1)))
  (comment "Not closed under rules"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr random32) (pms random48)
    (ppk skey) (spk cpk akey) (c s ca u name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0 gen-st-serverr-0)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie))))
  (label 212)
  (parent 211)
  (unrealized (0 2) (0 4) (0 5))
  (origs (sr (0 1)))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 akey)
    (c s ca u s-0 name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (precedes ((1 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (added-strand clientr 3)
    (enc (hash c cpk) (privk ca)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))))
  (label 213)
  (parent 212)
  (unrealized (0 2) (0 4) (0 5) (1 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr random32) (pms random48)
    (ppk skey) (spk akey) (s ca u name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk spk) (c s) (u u) (s s) (ca ca)
    (authstor authstor))
  (non-orig ppk (invk spk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (displaced 1 0 serverr 2)
    (enc (hash c cpk) (privk ca)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))
            (invk spk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)) (invk spk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (enc pms spk)) (invk spk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (enc pms spk)) (invk spk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie))))
  (label 214)
  (parent 212)
  (unrealized (0 2) (0 4) (0 5))
  (dead)
  (origs (sr (0 1)))
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c s ca u name) (pt pval)
    (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (precedes ((1 1) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash c cpk) (privk ca)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca))))))
  (label 215)
  (parent 212)
  (unrealized (0 2) (0 4) (0 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk akey) (c s ca u name)
    (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (displaced 2 0 serverr 2)
    (enc (hash s-0 spk-0) (privk ca)) (1 1))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))))
  (label 216)
  (parent 213)
  (unrealized (0 2) (0 4) (0 5))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (precedes ((1 2) (0 2)) ((2 1) (1 1)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s-0 spk-0) (privk ca)) (1 1))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))))
  (label 217)
  (parent 213)
  (unrealized (0 2) (0 4) (0 5))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c s ca u name) (pt pval)
    (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 218)
  (parent 215)
  (unrealized (0 4) (0 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr random32) (pms random48)
    (ppk skey) (spk cpk akey) (c s ca u name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (displaced 2 1 clientr 3)
    (enc
      (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 219)
  (parent 216)
  (unrealized (0 4) (0 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk akey) (c s ca u name)
    (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 220)
  (parent 216)
  (unrealized (0 4) (0 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (cpk spk akey) (c ca u s name) (pt pval)
    (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)) ((2 1) (1 1)))
  (non-orig ppk (invk cpk) (invk spk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (displaced 3 1 clientr 3)
    (enc
      (hash cr-1 sr-1 (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))))
  (label 221)
  (parent 217)
  (unrealized (0 4) (0 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 2) (0 2)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test (added-strand clientr 3)
    (enc
      (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
        (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
      (invk cpk)) (0 2))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))))
  (label 222)
  (parent 217)
  (unrealized (0 4) (0 5))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c s ca u name) (pt pval)
    (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk cpk) (s c) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 1) (2 1)) ((1 1) (0 2)) ((2 2) (0 2)) ((3 1) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((recv cr-0) (send (cat sr-0 c cpk (enc (hash c cpk) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 223)
  (parent 218)
  (unrealized (0 5) (3 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr random32) (pms random48)
    (ppk skey) (spk cpk akey) (c s ca u name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)) ((2 1) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 224)
  (parent 219)
  (unrealized (0 5) (2 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk akey) (c s ca u name)
    (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk)
    (cpk cpk) (c c) (s s) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 1) (1 1)) ((0 1) (2 1)) ((1 2) (0 2)) ((2 2) (0 2))
    ((3 1) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 225)
  (parent 220)
  (unrealized (0 5) (3 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (cpk spk akey) (c ca u s name) (pt pval)
    (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 1) (1 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 1) (0 4)))
  (non-orig ppk (invk cpk) (invk spk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 226)
  (parent 221)
  (unrealized (0 5) (3 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie data) (request httpreq)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 random48) (ppk skey)
    (spk cpk spk-0 akey) (c s ca u s-0 name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (authstor authstor))
  (defstrand clientr 3 (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk) (c c) (s s-0) (ca ca))
  (defstrand serverr 2 (cr cr-1) (sr sr-1) (spk spk-0) (s s-0) (ca ca))
  (defstrand clientr 3 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 1) (3 1)) ((1 2) (0 2)) ((2 1) (1 1)) ((3 2) (0 2))
    ((4 1) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig sr)
  (gen-st (cat "server store" s u cookie))
  (facts (neq u s))
  (rule fact-serverr-neq0)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (0 4))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat pt "server store" s u cookie)))
    ((send cr-0)
      (recv (cat sr-0 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca)))
              (enc pms-0 spk-0)) (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk-0)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write")))))
    ((recv cr-1)
      (send (cat sr-1 s-0 spk-0 (enc (hash s-0 spk-0) (privk ca)))))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write")))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 227)
  (parent 222)
  (unrealized (0 5) (4 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol ca basic
  (defrole clienta
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie any mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write"))) (load cookiestor any)
      (stor cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (defrole clientr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    (gen-st (cat "client store" u s cookie)))
  (defrole servera
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie data) (ppk skey) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))) (load authstor any)
      (stor authstor (cat "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie data) (ppk skey) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat "server store" s u cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (facts (neq u s))
    (gen-st (cat "server store" s u cookie)))
  (defrule clients-servers-distinct1
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct2
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct3
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct4
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "servera" z (idx 5)) (p "servera" "s" z s)
          (p "servera" "u" z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "s" z s)
          (p "serverr" "u" z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie mesg) (s u name))
      (implies
        (and (p "clientr" z (idx 5)) (p "clientr" "cookie" z cookie)
          (p "clientr" "s" z s) (p "clientr" "u" z u))
        (gen-st (cat "client store" u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "cookie" z cookie)
          (p "serverr" "u" z u) (p "serverr" "s" z s))
        (gen-st (cat "server store" s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (goals
    (forall
      ((any mesg) (cookie data) (response httpdata) (request httpreq)
        (p password) (cr sr random32) (pms random48) (c u s ca name)
        (cookiestor locn) (spk cpk akey) (z z-0 strd))
      (implies
        (and (p "clienta" z 10) (p "" z-0 2) (p "clienta" "any" z any)
          (p "clienta" "cookie" z cookie)
          (p "clienta" "response" z response) (p "clienta" "c" z c)
          (p "clienta" "cpk" z cpk) (p "clienta" "request" z request)
          (p "clienta" "p" z p) (p "clienta" "cr" z cr)
          (p "clienta" "sr" z sr) (p "clienta" "pms" z pms)
          (p "clienta" "u" z u) (p "clienta" "s" z s)
          (p "clienta" "spk" z spk) (p "clienta" "ca" z ca)
          (p "clienta" "cookiestor" z cookiestor) (p "" "x" z-0 cookie)
          (non (invk cpk)) (non (invk spk)) (non (privk ca)) (pnon p)
          (uniq sr) (uniq-at cr z 0) (uniq-at pms z 2)) (false))))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 228)
  (unrealized (1 1) (1 3) (1 5) (1 9))
  (origs (pt-0 (1 7)) (cr (1 0)) (pms (1 2)))
  (comment "Not closed under rules"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 229)
  (parent 228)
  (unrealized (1 1) (1 3) (1 5) (1 9))
  (origs (pt-0 (1 7)) (cr (1 0)) (pms (1 2)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (precedes ((2 1) (1 1)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s spk) (privk ca)) (1 1))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))))
  (label 230)
  (parent 229)
  (unrealized (1 3) (1 5) (1 9))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((1 0) (2 0)) ((1 2) (2 2)) ((2 1) (1 1)) ((2 3) (1 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 2 3 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (1 3))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 231)
  (parent 230)
  (unrealized (1 5) (1 9))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((1 0) (3 0)) ((1 2) (3 2)) ((2 1) (1 1)) ((3 1) (1 1))
    ((3 3) (1 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-strand serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (1 3))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 232)
  (parent 230)
  (unrealized (1 5) (1 9))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((2 1) (1 1)) ((3 1) (1 3)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (1 3))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 233)
  (parent 230)
  (unrealized (1 3) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((1 0) (2 0)) ((1 2) (2 2)) ((2 1) (1 1)) ((2 3) (1 3))
    ((3 1) (1 5)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc "login-successful" cookie
      (hash (hash pms cr sr) "server_write")) (1 5))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 234)
  (parent 231)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((1 0) (3 0)) ((1 2) (3 2)) ((2 1) (1 1)) ((3 1) (1 1))
    ((3 3) (1 3)) ((4 1) (1 5)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc "login-successful" cookie
      (hash (hash pms cr sr) "server_write")) (1 5))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 235)
  (parent 232)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((2 1) (1 1)) ((3 1) (1 3)) ((4 1) (3 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 236)
  (parent 233)
  (unrealized (1 3) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((1 0) (2 0)) ((1 2) (2 2)) ((2 1) (1 1)) ((2 3) (1 3))
    ((3 1) (1 5)) ((4 1) (3 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 237)
  (parent 234)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((1 0) (3 0)) ((1 2) (3 2)) ((2 1) (1 1)) ((3 1) (1 1))
    ((3 3) (1 3)) ((4 1) (1 5)) ((5 1) (4 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (4 0))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 238)
  (parent 235)
  (unrealized (5 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((1 2) (5 0)) ((2 1) (1 1)) ((3 1) (1 3)) ((4 1) (3 0))
    ((5 1) (4 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 239)
  (parent 236)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk cpk akey)
    (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((1 0) (2 0)) ((1 2) (2 2)) ((1 2) (5 0)) ((2 1) (1 1))
    ((2 3) (1 3)) ((3 1) (1 5)) ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 240)
  (parent 237)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (cookie cookie) (any any) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk)
    (cpk cpk) (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((1 0) (3 0)) ((1 2) (3 2)) ((1 2) (6 0)) ((2 1) (1 1))
    ((3 1) (1 1)) ((3 3) (1 3)) ((4 1) (1 5)) ((5 1) (4 0))
    ((6 1) (5 0)))
  (non-orig (invk spk) (invk cpk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (5 0))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 241)
  (parent 238)
  (unrealized (6 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol ca basic
  (defrole clienta
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie any mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write"))) (load cookiestor any)
      (stor cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (defrole clientr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    (gen-st (cat "client store" u s cookie)))
  (defrole servera
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie data) (ppk skey) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))) (load authstor any)
      (stor authstor (cat "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie data) (ppk skey) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat "server store" s u cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (facts (neq u s))
    (gen-st (cat "server store" s u cookie)))
  (defrule clients-servers-distinct1
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct2
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct3
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct4
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "servera" z (idx 5)) (p "servera" "s" z s)
          (p "servera" "u" z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "s" z s)
          (p "serverr" "u" z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie mesg) (s u name))
      (implies
        (and (p "clientr" z (idx 5)) (p "clientr" "cookie" z cookie)
          (p "clientr" "s" z s) (p "clientr" "u" z u))
        (gen-st (cat "client store" u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "cookie" z cookie)
          (p "serverr" "u" z u) (p "serverr" "s" z s))
        (gen-st (cat "server store" s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (goals
    (forall
      ((z strd) (cookie data) (c u s ca name) (cr sr random32)
        (pms random48) (spk cpk akey) (ppk skey))
      (implies
        (and (p "clienta" z 10)
          (p "clienta" "cookie" z
            (enc cookie (hash ppk (hash pms cr sr))))
          (p "clienta" "c" z c) (p "clienta" "cpk" z cpk)
          (p "clienta" "u" z u) (p "clienta" "s" z s)
          (p "clienta" "spk" z spk) (p "clienta" "ca" z ca)
          (p "clienta" "cr" z cr) (p "clienta" "sr" z sr)
          (p "clienta" "pms" z pms) (non (privk ca)) (non (invk cpk))
          (non (invk spk)) (non ppk) (uniq sr) (uniq-at cr z 0)
          (uniq-at pms z 2))
        (exists ((z0 strd))
          (and (p "servera" z0 10) (p "servera" "cookie" z0 cookie)
            (p "servera" "u" z0 u) (p "servera" "c" z0 c)
            (p "servera" "cpk" z0 cpk) (p "servera" "s" z0 s)
            (p "servera" "spk" z0 spk) (uniq-at cookie z0 5)
            (fact neq u s))))))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 242)
  (unrealized (0 1) (0 3) (0 5) (0 9))
  (origs (pt-0 (0 7)) (cr (0 0)) (pms (0 2)))
  (comment "Not closed under rules"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 243)
  (parent 242)
  (unrealized (0 1) (0 3) (0 5) (0 9))
  (origs (pt-0 (0 7)) (cr (0 0)) (pms (0 2)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (precedes ((1 1) (0 1)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s spk) (privk ca)) (0 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))))
  (label 244)
  (parent 243)
  (unrealized (0 3) (0 5) (0 9))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 1 2 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 245)
  (parent 244)
  (unrealized (0 5) (0 9))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-strand serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 246)
  (parent 244)
  (unrealized (0 5) (0 9))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((1 1) (0 1)) ((2 1) (0 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 247)
  (parent 244)
  (unrealized (0 3) (0 5) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((1 5) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 1 2 servera 6)
    (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 248)
  (parent 245)
  (unrealized (0 9) (1 4))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((2 1) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 249)
  (parent 245)
  (unrealized (0 5) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms random48)
    (ppk skey) (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 5) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 2 3 servera 6)
    (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 250)
  (parent 246)
  (unrealized (0 9) (2 4))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 1) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
      (hash (hash pms cr sr) "server_write")) (0 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 251)
  (parent 246)
  (unrealized (0 5) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((1 1) (0 1)) ((2 1) (0 3)) ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 252)
  (parent 247)
  (unrealized (0 3) (0 5) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 2 0 clienta 5)
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (1 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 253)
  (parent 248)
  (unrealized (0 9))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((1 5) (0 5)) ((2 1) (1 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (1 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 254)
  (parent 248)
  (unrealized (0 9) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((2 1) (0 5)) ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 255)
  (parent 249)
  (unrealized (0 5) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 3 0 clienta 5)
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (2 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 256)
  (parent 250)
  (unrealized (0 9))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms random48)
    (ppk skey) (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (2 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (2 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 257)
  (parent 250)
  (unrealized (0 9) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 1) (0 5)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 258)
  (parent 251)
  (unrealized (0 5) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 2) (4 0)) ((1 1) (0 1)) ((2 1) (0 3)) ((3 1) (2 0))
    ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 259)
  (parent 252)
  (unrealized (0 5) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 1 2 servera 10)
    (enc response (hash (hash pms cr sr) "server_write")) (0 9))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 260)
  (parent 253)
  (unrealized (1 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((2 1) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc response (hash (hash pms cr sr) "server_write")) (0 9))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 261)
  (parent 253)
  (unrealized (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((1 5) (0 5)) ((2 1) (1 4)) ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 262)
  (parent 254)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 2) (4 0)) ((1 1) (0 1))
    ((1 3) (0 3)) ((2 1) (0 5)) ((3 1) (2 0)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 263)
  (parent 255)
  (unrealized (0 5) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((2 9) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 3 servera 10)
    (enc response (hash (hash pms cr sr) "server_write")) (0 9))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 264)
  (parent 256)
  (unrealized (2 8))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc response (hash (hash pms cr sr) "server_write")) (0 9))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 265)
  (parent 256)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms random48)
    (ppk skey) (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (2 4)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 266)
  (parent 257)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (c u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((3 1) (0 5)) ((4 1) (3 0))
    ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 267)
  (parent 258)
  (unrealized (0 5) (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p password) (cr sr random32) (pms random48)
    (ppk skey) (spk cpk akey) (c u s ca name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((0 8) (1 8))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 0 clienta 9)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (1 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 268)
  (parent 260)
  (realized)
  (shape)
  (satisfies yes)
  (maps
    ((0)
      ((cookie cookie) (c c) (u u) (s s) (ca ca) (cr cr) (sr sr)
        (pms pms) (spk spk) (cpk cpk) (ppk ppk) (p p) (any any)
        (cookiestor cookiestor) (request request) (response response))))
  (origs (pt-0 (0 7)) (cookie (1 5)) (pt-2 (1 7)) (sr (1 1)) (cr (0 0))
    (pms (0 2))))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)) ((2 1) (1 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (1 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 269)
  (parent 260)
  (unrealized (1 8) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((2 1) (0 9)) ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 270)
  (parent 261)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 2) (4 0)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((2 1) (1 4)) ((3 1) (2 0))
    ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 271)
  (parent 262)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((0 8) (2 8))
    ((1 1) (0 1)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5))
    ((2 9) (0 9)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 3 0 clienta 9)
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (2 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write")))))
  (label 272)
  (parent 264)
  (seen 268)
  (realized)
  (comment "1 in cohort - 0 not yet seen"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((2 9) (0 9))
    ((3 1) (2 8)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
      (hash (hash pms cr sr) "client_write")) (2 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 273)
  (parent 264)
  (unrealized (2 8) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (0 9))
    ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 274)
  (parent 265)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms random48)
    (ppk skey) (spk cpk akey) (u c u-0 s ca name) (pt pt-0 pval)
    (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u-0) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((3 1) (2 4))
    ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u-0 s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 275)
  (parent 266)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((1 1) (0 1))
    ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)) ((2 1) (1 8))
    ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 276)
  (parent 269)
  (unrealized (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 2) (4 0)) ((0 4) (1 4))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((2 1) (0 9))
    ((3 1) (2 0)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 277)
  (parent 270)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 4) (2 4)) ((1 1) (0 1))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5)) ((2 9) (0 9))
    ((3 1) (2 8)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 278)
  (parent 273)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey)
    (spk cpk akey) (u c s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 6 (cookie cookie) (p p) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((0 4) (2 4))
    ((1 1) (0 1)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5))
    ((3 1) (0 9)) ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 279)
  (parent 274)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 2) (4 0)) ((0 4) (1 4))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9))
    ((2 1) (1 8)) ((3 1) (2 0)) ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 280)
  (parent 276)
  (unrealized (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms random48) (ppk skey) (spk cpk akey) (c u s ca name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10
    (cookie (enc cookie (hash ppk (hash pms cr sr)))) (any any)
    (response response) (request request) (p p) (cr cr) (sr sr)
    (pms pms) (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request-0) (p p) (cr cr) (sr sr) (pms pms) (ppk ppk)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca) (authstor authstor))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((0 4) (2 4))
    ((1 1) (0 1)) ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (0 5))
    ((2 9) (0 9)) ((3 1) (2 8)) ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat pt any))
      (stor cookiestor
        (cat pt-0 "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request-0
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 281)
  (parent 278)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol ca basic
  (defrole clienta
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie any mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (send (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (recv
        (enc "login-successful" cookie
          (hash (hash pms cr sr) "server_write"))) (load cookiestor any)
      (stor cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (defrole clientr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie mesg) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor (cat "client store" u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    (gen-st (cat "client store" u s cookie)))
  (defrole servera
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (p password) (cookie data) (ppk skey) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv (enc "login" u p (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))) (load authstor any)
      (stor authstor (cat "server store" s u cookie))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (c u s ca name) (cr sr random32) (spk cpk akey) (pms random48)
      (cookie data) (ppk skey) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (load authstor (cat "server store" s u cookie))
      (send (enc response (hash (hash pms cr sr) "server_write"))))
    (non-orig ppk)
    (facts (neq u s))
    (gen-st (cat "server store" s u cookie)))
  (defrule clients-servers-distinct1
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct2
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clienta" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct3
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clientr" "s" z-0 c))
        (false))))
  (defrule clients-servers-distinct4
    (forall ((z z-0 strd) (c name))
      (implies
        (and (p "clientr" "c" z c) (p "clienta" "s" z-0 c))
        (false))))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "servera" z (idx 5)) (p "servera" "s" z s)
          (p "servera" "u" z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "s" z s)
          (p "serverr" "u" z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p "clienta" z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p "servera" z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie mesg) (s u name))
      (implies
        (and (p "clientr" z (idx 5)) (p "clientr" "cookie" z cookie)
          (p "clientr" "s" z s) (p "clientr" "u" z u))
        (gen-st (cat "client store" u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p "serverr" z (idx 6)) (p "serverr" "cookie" z cookie)
          (p "serverr" "u" z u) (p "serverr" "s" z s))
        (gen-st (cat "server store" s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))

(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (goals
    (forall
      ((z strd) (cookie data) (c u s ca name) (cr sr random32)
        (pms random48) (ppk skey) (spk cpk akey))
      (implies
        (and (p "clientr" z 7)
          (p "clientr" "cookie" z
            (enc cookie (hash ppk (hash pms cr sr))))
          (p "clientr" "c" z c) (p "clientr" "cpk" z cpk)
          (p "clientr" "u" z u) (p "clientr" "s" z s)
          (p "clientr" "spk" z spk) (p "clientr" "ca" z ca)
          (p "clientr" "cr" z cr) (p "clientr" "sr" z sr)
          (p "clientr" "pms" z pms) (non (privk ca)) (non (invk cpk))
          (non (invk spk)) (non ppk) (uniq sr) (uniq-at cr z 0)
          (uniq-at pms z 2))
        (exists ((z0 strd))
          (and (p "servera" z0 8) (p "servera" "cookie" z0 cookie)
            (p "servera" "u" z0 u) (p "servera" "c" z0 c)
            (p "servera" "cpk" z0 cpk) (p "servera" "s" z0 s)
            (p "servera" "spk" z0 spk) (uniq-at cookie z0 5)
            (fact neq u s))))))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 282)
  (unrealized (0 1) (0 3) (0 4) (0 6))
  (origs (cr (0 0)) (pms (0 2)))
  (comment "Not closed under rules"))

(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (rule gen-st-clientr-0)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write")))))
  (label 283)
  (parent 282)
  (unrealized (0 1) (0 3) (0 4) (0 6))
  (origs (cr (0 0)) (pms (0 2)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (precedes ((1 1) (0 1)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (operation encryption-test (added-strand serverr 2)
    (enc (hash s spk) (privk ca)) (0 1))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca))))))
  (label 284)
  (parent 283)
  (unrealized (0 3) (0 4) (0 6))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (operation encryption-test (displaced 1 2 serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 285)
  (parent 284)
  (unrealized (0 4) (0 6))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (operation encryption-test (added-strand serverr 4)
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))))
  (label 286)
  (parent 284)
  (unrealized (0 4) (0 6))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (precedes ((1 1) (0 1)) ((2 1) (0 3)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "server_write"))
    (enc
      (hash pms "server finished"
        (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
          (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (hash (hash pms cr sr) "server_write")) (0 3))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write"))))
  (label 287)
  (parent 284)
  (unrealized (0 3) (0 4) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (ppk skey) (spk cpk spk-0 cpk-0 akey) (c u s ca c-0 ca-0 name)
    (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((2 7) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (leads-to ((2 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation channel-test (added-strand clienta 8)
    (ch-msg cookiestor
      (cat pt "client store" u s
        (enc cookie (hash ppk (hash pms cr sr))))) (0 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-0)
      (recv (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-0 sr-0
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))))
  (label 288)
  (parent 285)
  (unrealized (0 6) (2 5))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (c u s ca c-0 ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-1) (sr sr-1) (pms pms-0) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 7) (0 4)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (leads-to ((3 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation channel-test (added-strand clienta 8)
    (ch-msg cookiestor
      (cat pt "client store" u s
        (enc cookie (hash ppk (hash pms cr sr))))) (0 4))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))))
  (label 289)
  (parent 286)
  (unrealized (0 6) (3 5))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (precedes ((1 1) (0 1)) ((2 1) (0 3)) ((3 1) (2 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "server_write"))
    (hash (hash pms cr sr) "server_write") (2 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write"))))
  (label 290)
  (parent 287)
  (unrealized (0 3) (0 4) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (ppk skey) (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 7) (0 4)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 5) (1 5)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 1 3 servera 6)
    (enc cookie (hash ppk (hash pms cr sr))) (2 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 291)
  (parent 288)
  (unrealized (0 6) (1 5) (2 4))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (ppk skey) (spk cpk spk-0 cpk-0 akey) (c u s ca c-0 ca-0 name)
    (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((1 1) (0 1)) ((1 3) (0 3))
    ((2 7) (0 4)) ((3 1) (2 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (leads-to ((2 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (2 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-0)
      (recv (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-0 sr-0
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 292)
  (parent 288)
  (unrealized (0 6) (3 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-1) (sr sr-1) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((1 1) (0 1)) ((2 7) (0 4))
    ((3 1) (0 1)) ((3 3) (0 3)) ((3 5) (2 5)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (displaced 2 4 servera 6)
    (enc cookie (hash ppk (hash pms cr sr))) (3 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write")))))
  (label 293)
  (parent 289)
  (unrealized (0 6) (2 5) (3 4))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (c u s ca c-0 ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (defstrand serverr 4 (cr cr) (sr sr) (pms pms) (spk spk) (cpk cpk)
    (c c) (s s) (ca ca))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-1) (sr sr-1) (pms pms-0) (spk spk-0)
    (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))
  (deflistener (hash ppk (hash pms cr sr)))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 1) (0 1)) ((2 1) (0 1))
    ((2 3) (0 3)) ((3 7) (0 4)) ((4 1) (3 5)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (leads-to ((3 7) (0 4)))
  (rule trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash ppk (hash pms cr sr)))
    (enc cookie (hash ppk (hash pms cr sr))) (3 5))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write"))))
    ((send cr-1)
      (recv (cat sr-1 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms-0 spk-0)
          (enc
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)) (invk cpk-0))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms-0 spk-0)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)) (invk cpk-0))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash cr-1 sr-1
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms-0 spk-0)) (invk cpk-0))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms-0 spk-0)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms-0 spk-0)) (invk cpk-0))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv (hash ppk (hash pms cr sr)))
      (send (hash ppk (hash pms cr sr)))))
  (label 294)
  (parent 289)
  (unrealized (0 6) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr cr-0 sr-0 random32) (pms random48) (ppk skey) (spk cpk akey)
    (c u s ca name) (pt pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk) (cpk cpk) (c c) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk) (s s) (ca ca))
  (deflistener (hash (hash pms cr sr) "server_write"))
  (deflistener (cat (hash pms cr sr) "server_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 2) (4 0)) ((1 1) (0 1)) ((2 1) (0 3)) ((3 1) (2 0))
    ((4 1) (3 0)))
  (non-orig ppk (invk spk) (invk cpk) (privk ca))
  (uniq-orig cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (3 0))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
          (enc
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk))
            (invk cpk))
          (enc
            (hash pms "client finished"
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
                (enc
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)) (invk cpk))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms spk)
              (enc
                (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms spk)) (invk cpk))
              (enc
                (hash pms "client finished"
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms spk)
                    (enc
                      (hash cr sr
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms spk)) (invk cpk))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0) (send (cat sr-0 s spk (enc (hash s spk) (privk ca)))))
    ((recv (hash (hash pms cr sr) "server_write"))
      (send (hash (hash pms cr sr) "server_write")))
    ((recv (cat (hash pms cr sr) "server_write"))
      (send (cat (hash pms cr sr) "server_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 295)
  (parent 290)
  (unrealized (0 4) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (ppk skey) (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 7) (0 4)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 5) (1 5)) ((3 1) (2 4)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (2 4))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 296)
  (parent 291)
  (unrealized (0 6) (1 5) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-1) (sr sr-1) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((1 1) (0 1)) ((2 7) (0 4))
    ((3 1) (0 1)) ((3 3) (0 3)) ((3 5) (2 5)) ((4 1) (3 4)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (hash (hash pms cr sr) "client_write"))
    (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")) (3 4))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write"))))
  (label 297)
  (parent 293)
  (unrealized (0 6) (2 5) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (ppk skey) (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((1 7) (0 4)) ((2 1) (0 1))
    ((2 3) (0 3)) ((2 5) (1 5)) ((3 1) (2 4)) ((4 1) (3 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (3 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 298)
  (parent 296)
  (unrealized (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-1) (sr sr-1) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((1 1) (0 1)) ((2 7) (0 4))
    ((3 1) (0 1)) ((3 3) (0 3)) ((3 5) (2 5)) ((4 1) (3 4))
    ((5 1) (4 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test
    (added-listener (cat (hash pms cr sr) "client_write"))
    (hash (hash pms cr sr) "client_write") (4 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write"))))
  (label 299)
  (parent 297)
  (unrealized (5 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 random32) (pms pms-0 random48)
    (ppk skey) (spk cpk spk-0 cpk-0 akey) (u c ca c-0 u-0 s ca-0 name)
    (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 2) (5 0)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 5) (1 5)) ((3 1) (2 4))
    ((4 1) (3 0)) ((5 1) (4 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (4 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-0 sr-0) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-0 sr-0
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-0 sr-0
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-0 sr-0) "client_write"))))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-0 sr-0) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-0 sr-0) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 300)
  (parent 298)
  (unrealized (5 0))
  (dead)
  (comment "empty cohort"))

(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p p-0 password) (cr sr cr-0 sr-0 cr-1 sr-1 random32)
    (pms pms-0 random48) (ppk skey) (spk cpk spk-0 cpk-0 akey)
    (u c ca c-0 u-0 s ca-0 name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clientr 7 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (response response) (request request) (cr cr) (sr sr) (pms pms)
    (spk spk-0) (cpk cpk-0) (c c-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (defstrand serverr 2 (cr cr-0) (sr sr-0) (spk spk-0) (s s) (ca ca-0))
  (defstrand clienta 8 (cookie (enc cookie (hash ppk (hash pms cr sr))))
    (any any) (p p) (cr cr-1) (sr sr-1) (pms pms-0) (spk spk) (cpk cpk)
    (c c) (u u) (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 6 (cookie cookie) (p p-0) (cr cr) (sr sr) (pms pms)
    (ppk ppk) (spk spk-0) (cpk cpk-0) (c c-0) (u u-0) (s s) (ca ca-0))
  (deflistener (hash (hash pms cr sr) "client_write"))
  (deflistener (cat (hash pms cr sr) "client_write"))
  (deflistener (cat pms cr sr))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((0 2) (6 0)) ((1 1) (0 1))
    ((2 7) (0 4)) ((3 1) (0 1)) ((3 3) (0 3)) ((3 5) (2 5))
    ((4 1) (3 4)) ((5 1) (4 0)) ((6 1) (5 0)))
  (non-orig ppk (invk spk-0) (invk cpk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st
    (cat "client store" u s (enc cookie (hash ppk (hash pms cr sr)))))
  (facts (neq u-0 s))
  (leads-to ((2 7) (0 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7)
  (operation encryption-test (added-listener (cat pms cr sr))
    (hash pms cr sr) (5 0))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (recv
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (load cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr)))))
      (send
        (enc (enc cookie (hash ppk (hash pms cr sr))) request
          (hash (hash pms cr sr) "client_write")))
      (recv (enc response (hash (hash pms cr sr) "server_write"))))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))))
    ((send cr-1) (recv (cat sr-1 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
          (enc
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk))
            (invk cpk))
          (enc
            (hash pms-0 "client finished"
              (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
                (cat c cpk (enc (hash c cpk) (privk ca)))
                (enc pms-0 spk)
                (enc
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)) (invk cpk))))
            (hash (hash pms-0 cr-1 sr-1) "client_write"))))
      (recv
        (enc
          (hash pms-0 "server finished"
            (hash cr-1 sr-1 (cat s spk (enc (hash s spk) (privk ca)))
              (cat c cpk (enc (hash c cpk) (privk ca))) (enc pms-0 spk)
              (enc
                (hash cr-1 sr-1
                  (cat s spk (enc (hash s spk) (privk ca)))
                  (cat c cpk (enc (hash c cpk) (privk ca)))
                  (enc pms-0 spk)) (invk cpk))
              (enc
                (hash pms-0 "client finished"
                  (hash cr-1 sr-1
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (cat c cpk (enc (hash c cpk) (privk ca)))
                    (enc pms-0 spk)
                    (enc
                      (hash cr-1 sr-1
                        (cat s spk (enc (hash s spk) (privk ca)))
                        (cat c cpk (enc (hash c cpk) (privk ca)))
                        (enc pms-0 spk)) (invk cpk))))
                (hash (hash pms-0 cr-1 sr-1) "client_write"))))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (send
        (enc "login" u p (hash (hash pms-0 cr-1 sr-1) "client_write")))
      (recv
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms-0 cr-1 sr-1) "server_write")))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor
        (cat pt "client store" u s
          (enc cookie (hash ppk (hash pms cr sr))))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
          (enc pms spk-0)
          (enc
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)) (invk cpk-0))
          (enc
            (hash pms "client finished"
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                (enc pms spk-0)
                (enc
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)) (invk cpk-0))))
            (hash (hash pms cr sr) "client_write"))))
      (send
        (enc
          (hash pms "server finished"
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash cr sr
                  (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                  (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                  (enc pms spk-0)) (invk cpk-0))
              (enc
                (hash pms "client finished"
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (cat c-0 cpk-0 (enc (hash c-0 cpk-0) (privk ca-0)))
                    (enc pms spk-0)
                    (enc
                      (hash cr sr
                        (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                        (cat c-0 cpk-0
                          (enc (hash c-0 cpk-0) (privk ca-0)))
                        (enc pms spk-0)) (invk cpk-0))))
                (hash (hash pms cr sr) "client_write"))))
          (hash (hash pms cr sr) "server_write")))
      (recv
        (enc "login" u-0 p-0 (hash (hash pms cr sr) "client_write")))
      (send
        (enc "login-successful" (enc cookie (hash ppk (hash pms cr sr)))
          (hash (hash pms cr sr) "server_write"))))
    ((recv (hash (hash pms cr sr) "client_write"))
      (send (hash (hash pms cr sr) "client_write")))
    ((recv (cat (hash pms cr sr) "client_write"))
      (send (cat (hash pms cr sr) "client_write")))
    ((recv (cat pms cr sr)) (send (cat pms cr sr))))
  (label 301)
  (parent 299)
  (unrealized (6 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")
