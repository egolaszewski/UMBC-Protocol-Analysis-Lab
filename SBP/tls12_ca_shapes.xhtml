<?xml version="1.0"?>
<!-- CPSA 4.4.2 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>Cookie Authentication with TLS 1.2</title>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <style>
  svg.diagram { border-width: 1px; border-style: solid }
 </style>
</head>
<body>

<pre>(comment &quot;CPSA 4.4.2&quot;)
(comment &quot;Extracted shapes&quot;)
(herald &quot;Cookie Authentication with TLS 1.2&quot; (bound 12))
(comment &quot;CPSA 4.4.2&quot;)
(comment &quot;All input read from tls12_ca.scm&quot;)
(comment &quot;Strand count bounded at 12&quot;)</pre>

<p id="top">Trees: <a href="#t0">0</a> <a href="#t40">40</a> <a href="#t194">194</a> <a href="#t237">237</a> <a href="#t239">239</a> <a href="#t241">241</a> <a href="#t244">244</a> <a href="#t350">350</a> <a href="#t390">390</a>.</p>

<p id="t0">Tree <a href="#top">0</a>, POV <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k26&quot;, &quot;_self&quot;)'>26</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k0&quot;, &quot;_self&quot;)'>0</text>
  </svg></div>

<pre>(defprotocol ca basic
  (defrole clienta
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (cookiestor locn)
      (request httpreq) (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load cookiestor any)
      (stor cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (defrole clientr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (gen-st (cat &quot;client store&quot; u s cookie)))
  (defrole servera
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load authstor any)
      (stor authstor (cat &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat &quot;server store&quot; s u cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (facts (neq u s))
    (gen-st (cat &quot;server store&quot; s u cookie)))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;servera&quot; z (idx 5)) (p &quot;servera&quot; &quot;s&quot; z s)
          (p &quot;servera&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;s&quot; z s)
          (p &quot;serverr&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie data) (s u name))
      (implies
        (and (p &quot;clientr&quot; z (idx 5)) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;s&quot; z s) (p &quot;clientr&quot; &quot;u&quot; z u))
        (gen-st (cat &quot;client store&quot; u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;cookie&quot; z cookie)
          (p &quot;serverr&quot; &quot;u&quot; z u) (p &quot;serverr&quot; &quot;s&quot; z s))
        (gen-st (cat &quot;server store&quot; s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))</pre>

<p id="k0">Item <a href="#t0">0</a>, Child: <a href="#k26">26</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: red;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title><circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <text x='39.960' y='39.960' style='text-anchor: middle;'>ca 0</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk akey)
    (u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (any any) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (label 0)
  (unrealized (0 1) (0 3) (0 5) (0 9))
  (origs (pt-0 (0 7)) (cr (0 0)) (pms (0 2)))
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k26">Item <a href="#t0">26</a>, Parent: <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 789.960 Q 92.940 789.960 45.960 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='139.920' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-2 &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt-1 any-0))</title>
   <circle style='fill: gray;' cx='139.920' cy='564.960' r='6.000'/></g>
  <path
   d='M 139.920 489.960 Q 92.940 489.960 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='789.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 86.940 714.960 133.920 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <path
   d='M 39.960 414.960 Q 86.940 414.960 133.920 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>cr</title><circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any-0) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <g>
   <title>((any any) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <text x='89.940' y='39.960' style='text-anchor: middle;'>ca 26</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p password) (cr sr random32) (pms random48)
    (spk akey) (u s ca name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clienta 10 (any any) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((0 8) (1 8))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)))
  (non-orig (invk spk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 0 clienta 9)
    (enc cookie request-0 (hash (hash pms cr sr) &quot;client_write&quot;)) (1 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (label 26)
  (parent 0)
  (realized)
  (shape)
  (maps
    ((0)
      ((u u) (s s) (ca ca) (spk spk) (p p) (cr cr) (sr sr) (pms pms)
        (cookie cookie) (any any) (cookiestor cookiestor)
        (request request) (response response))))
  (origs (pt-0 (0 7)) (cookie (1 5)) (pt-2 (1 7)) (cr (0 0)) (pms (0 2))
    (sr (1 1))))</pre>

<p id="t40">Tree <a href="#top">40</a>, POV <a href="#k40">40</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k104&quot;, &quot;_self&quot;)'>104</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k40&quot;, &quot;_self&quot;)'>40</text>
  </svg></div>

<pre>(defprotocol ca basic
  (defrole clienta
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (cookiestor locn)
      (request httpreq) (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load cookiestor any)
      (stor cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (defrole clientr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (gen-st (cat &quot;client store&quot; u s cookie)))
  (defrole servera
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load authstor any)
      (stor authstor (cat &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat &quot;server store&quot; s u cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (facts (neq u s))
    (gen-st (cat &quot;server store&quot; s u cookie)))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;servera&quot; z (idx 5)) (p &quot;servera&quot; &quot;s&quot; z s)
          (p &quot;servera&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;s&quot; z s)
          (p &quot;serverr&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie data) (s u name))
      (implies
        (and (p &quot;clientr&quot; z (idx 5)) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;s&quot; z s) (p &quot;clientr&quot; &quot;u&quot; z u))
        (gen-st (cat &quot;client store&quot; u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;cookie&quot; z cookie)
          (p &quot;serverr&quot; &quot;u&quot; z u) (p &quot;serverr&quot; &quot;s&quot; z s))
        (gen-st (cat &quot;server store&quot; s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))</pre>

<p id="k40">Item <a href="#t40">40</a>, Child: <a href="#k104">104</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>cookie</title><circle cx='139.920' cy='189.960' r='6.000'/>
   </g>
  <g><title>cookie</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: red;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title><circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <text x='89.940' y='39.960' style='text-anchor: middle;'>ca 40</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk akey)
    (u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (any any) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (cookiestor cookiestor))
  (deflistener cookie)
  (non-orig (invk spk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((recv cookie) (send cookie)))
  (label 40)
  (unrealized (0 1) (0 3) (0 5) (0 9))
  (origs (pt-0 (0 7)) (cr (0 0)) (pms (0 2)))
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k104">Item <a href="#t40">104</a>, Parent: <a href="#k40">40</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='339.960' x2='239.880' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='714.960' x2='139.920' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 789.960 Q 192.900 752.460 45.960 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='339.840' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-2 &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='339.840' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt-1 any-0))</title>
   <circle style='fill: gray;' cx='339.840' cy='564.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 192.900 302.460 45.960 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 339.840 189.960 Q 192.900 152.460 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat sr s spk-0 (enc (hash s spk-0) (privk ca-0)))</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 714.960 Q 192.900 714.960 145.920 714.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc cookie request-0 (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))</title>
   <circle cx='239.880' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='239.880' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms-0 &quot;server finished&quot; (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca))) (enc pms-0 spk) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca))) (enc pms-0 spk))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))) (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='239.880' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms-0 spk) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca))) (enc pms-0 spk))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))</title>
   <circle cx='239.880' cy='489.960' r='6.000'/></g>
  <g><title>(cat sr-0 s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: blue;' cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>cr-0</title><circle cx='239.880' cy='339.960' r='6.000'/>
   </g>
  <g><title>cookie</title><circle cx='139.920' cy='789.960' r='6.000'/>
   </g>
  <g><title>cookie</title>
   <circle style='fill: blue;' cx='139.920' cy='714.960' r='6.000'/></g>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='789.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 186.900 677.460 333.840 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <path
   d='M 39.960 639.960 Q 136.920 602.460 233.880 639.960'
   style='stroke-width: 0.960; stroke: blue; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <path
   d='M 39.960 414.960 Q 186.900 377.460 333.840 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 186.900 227.460 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk-0 (enc (hash s spk-0) (privk ca-0)))</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 186.900 77.460 333.840 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>cr</title><circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any-0) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u) (s s) (ca ca-0) (authstor authstor))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <g>
   <title>((cookie cookie) (request request-0) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>clientr</text>
   </g>
  <g>
   <title>((any any) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <text
   x='189.900' y='39.960' style='text-anchor: middle;'>ca 104</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (spk spk-0 akey) (ca u s ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clienta 10 (any any) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u)
    (s s) (ca ca-0) (cookiestor cookiestor))
  (deflistener cookie)
  (defstrand clientr 6 (cookie cookie) (request request-0) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u)
    (s s) (ca ca-0) (authstor authstor))
  (precedes ((0 0) (3 0)) ((0 2) (3 2)) ((0 4) (3 4)) ((0 7) (2 4))
    ((0 8) (3 8)) ((2 5) (1 0)) ((3 1) (0 1)) ((3 3) (0 3))
    ((3 5) (0 5)) ((3 9) (0 9)))
  (non-orig (invk spk-0) (privk ca-0))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (gen-st (cat &quot;client store&quot; u s cookie))
  (facts (neq u s))
  (leads-to ((0 7) (2 4)))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 4 0 clienta 9)
    (enc cookie request-1 (hash (hash pms cr sr) &quot;client_write&quot;)) (3 8))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (enc pms spk-0)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (enc pms spk-0)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms spk-0)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((recv cookie) (send cookie))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms-0 spk)
          (enc
            (hash pms-0 &quot;client finished&quot;
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms-0 spk)))
            (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms-0 &quot;server finished&quot;
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms-0 spk)
              (enc
                (hash pms-0 &quot;client finished&quot;
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms-0 spk)))
                (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
          (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;)))
      (load cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send
        (enc cookie request-0
          (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (enc pms spk-0)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (enc pms spk-0)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms spk-0)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (label 104)
  (parent 40)
  (realized)
  (shape)
  (maps
    ((0 1)
      ((u u) (s s) (ca ca-0) (spk spk-0) (p p) (cr cr) (sr sr) (pms pms)
        (cookie cookie) (any any) (cookiestor cookiestor)
        (request request) (response response))))
  (origs (pt-0 (0 7)) (cookie (3 5)) (pt-2 (3 7)) (cr (0 0)) (pms (0 2))
    (sr (3 1))))</pre>

<p id="t194">Tree <a href="#top">194</a>, POV <a href="#k194">194</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k219&quot;, &quot;_self&quot;)'>219</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k194&quot;, &quot;_self&quot;)'>194</text>
  </svg></div>

<pre>(defprotocol ca basic
  (defrole clienta
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (cookiestor locn)
      (request httpreq) (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load cookiestor any)
      (stor cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (defrole clientr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (gen-st (cat &quot;client store&quot; u s cookie)))
  (defrole servera
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load authstor any)
      (stor authstor (cat &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat &quot;server store&quot; s u cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (facts (neq u s))
    (gen-st (cat &quot;server store&quot; s u cookie)))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;servera&quot; z (idx 5)) (p &quot;servera&quot; &quot;s&quot; z s)
          (p &quot;servera&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;s&quot; z s)
          (p &quot;serverr&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie data) (s u name))
      (implies
        (and (p &quot;clientr&quot; z (idx 5)) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;s&quot; z s) (p &quot;clientr&quot; &quot;u&quot; z u))
        (gen-st (cat &quot;client store&quot; u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;cookie&quot; z cookie)
          (p &quot;serverr&quot; &quot;u&quot; z u) (p &quot;serverr&quot; &quot;s&quot; z s))
        (gen-st (cat &quot;server store&quot; s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))</pre>

<p id="k194">Item <a href="#t194">194</a>, Child: <a href="#k219">219</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: red;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title><circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((cookie cookie) (response response) (request request) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clientr</text>
   </g>
  <text x='39.960' y='39.960' style='text-anchor: middle;'>ca 194</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr random32) (pms random48) (spk akey) (s ca u name) (pt pval)
    (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s)
    (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (privk ca))
  (uniq-orig cr sr pms)
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (label 194)
  (unrealized (0 1) (0 3) (0 6))
  (origs (cr (0 0)) (pms (0 2)))
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k219">Item <a href="#t194">219</a>, Parent: <a href="#k194">194</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='904.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 904.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='339.960' x2='239.880' y2='864.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='864.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 639.960 Q 291.524 712.464 243.207 784.967'
   style='stroke-width: 0.960; stroke: blue; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg authstor (cat pt-1 &quot;server store&quot; s u-0 cookie))</title>
   <circle style='fill: gray;' cx='339.840' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt-2 any-0))</title>
   <circle style='fill: gray;' cx='339.840' cy='564.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 242.880 452.460 145.920 489.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms-1 cr-1 sr-1) &quot;server_write&quot;))</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u-0 p-0 (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms-1 &quot;server finished&quot; (hash cr-1 sr-1 (cat s spk-1 (enc (hash s spk-1) (privk ca-1))) (enc pms-1 spk-1) (enc (hash pms-1 &quot;client finished&quot; (hash cr-1 sr-1 (cat s spk-1 (enc (hash s spk-1) (privk ca-1))) (enc pms-1 spk-1))) (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;)))) (hash (hash pms-1 cr-1 sr-1) &quot;server_write&quot;))</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms-1 spk-1) (enc (hash pms-1 &quot;client finished&quot; (hash cr-1 sr-1 (cat s spk-1 (enc (hash s spk-1) (privk ca-1))) (enc pms-1 spk-1))) (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr-1 s spk-1 (enc (hash s spk-1) (privk ca-1)))</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g><title>cr-1</title>
   <circle style='fill: blue;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 864.960 Q 142.920 827.460 45.960 864.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='239.880' cy='864.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-1 &quot;server store&quot; s u-0 cookie))</title>
   <circle style='fill: gray;' cx='239.880' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='239.880' cy='714.960' r='6.000'/></g>
  <path
   d='M 239.880 564.960 Q 142.920 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='239.880' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='489.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat sr s spk-0 (enc (hash s spk-0) (privk ca-0)))</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 639.960 Q 92.940 639.960 45.960 639.960'
   style='stroke-width: 0.960; stroke: blue; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg cookiestor (cat pt &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt-0 any))</title>
   <circle style='fill: gray;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms-0 &quot;server finished&quot; (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca))) (enc pms-0 spk) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca))) (enc pms-0 spk))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))) (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms-0 spk) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca))) (enc pms-0 spk))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr-0 s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>cr-0</title><circle cx='139.920' cy='114.960' r='6.000'/>
   </g>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='864.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 136.920 677.460 233.880 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <path
   d='M 39.960 489.960 Q 136.920 452.460 233.880 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>(cat sr s spk-0 (enc (hash s spk-0) (privk ca-0)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <path
   d='M 39.960 339.960 Q 136.920 302.460 233.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>cr</title><circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((any any-0) (cookie cookie) (p p-0) (cr cr-1) (sr sr-1) (pms pms-1) (spk spk-1) (u u-0) (s s) (ca ca-1) (authstor authstor))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <g>
   <title>((cookie cookie) (response response) (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u-0) (s s) (ca ca-0) (authstor authstor))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>serverr</text>
   </g>
  <g>
   <title>((any any) (cookie cookie) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <g>
   <title>((cookie cookie) (response response) (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clientr</text>
   </g>
  <text
   x='189.900' y='39.960' style='text-anchor: middle;'>ca 219</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (spk spk-0 spk-1 akey) (u ca u-0 s ca-0 ca-1 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (any any) (cookie cookie) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u-0)
    (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (spk spk-1) (u u-0) (s s) (ca ca-1)
    (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 5) (1 5))
    ((3 7) (2 5)))
  (non-orig (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st (cat &quot;client store&quot; u s cookie)
    (cat &quot;server store&quot; s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation channel-test (added-strand servera 8)
    (ch-msg authstor (cat pt-1 &quot;server store&quot; s u-0 cookie)) (2 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (enc pms spk-0)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (enc pms spk-0)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms spk-0)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms-0 spk)
          (enc
            (hash pms-0 &quot;client finished&quot;
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms-0 spk)))
            (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms-0 &quot;server finished&quot;
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms-0 spk)
              (enc
                (hash pms-0 &quot;client finished&quot;
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms-0 spk)))
                (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
          (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;)))
      (send
        (enc &quot;login&quot; u p (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;)))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt &quot;client store&quot; u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (enc pms spk-0)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (enc pms spk-0)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms spk-0)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat pt-1 &quot;server store&quot; s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((recv cr-1)
      (send (cat sr-1 s spk-1 (enc (hash s spk-1) (privk ca-1))))
      (recv
        (cat (enc pms-1 spk-1)
          (enc
            (hash pms-1 &quot;client finished&quot;
              (hash cr-1 sr-1
                (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                (enc pms-1 spk-1)))
            (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms-1 &quot;server finished&quot;
            (hash cr-1 sr-1
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (enc pms-1 spk-1)
              (enc
                (hash pms-1 &quot;client finished&quot;
                  (hash cr-1 sr-1
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (enc pms-1 spk-1)))
                (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;))))
          (hash (hash pms-1 cr-1 sr-1) &quot;server_write&quot;)))
      (recv
        (enc &quot;login&quot; u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms-1 cr-1 sr-1) &quot;server_write&quot;)))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 &quot;server store&quot; s u-0 cookie))))
  (label 219)
  (parent 194)
  (realized)
  (shape)
  (maps
    ((0)
      ((s s) (ca ca-0) (spk spk-0) (cr cr) (sr sr) (pms pms) (u u)
        (cookie cookie) (cookiestor cookiestor) (request request)
        (response response))))
  (origs (cookie (3 5)) (pt-1 (3 7)) (pt (1 7)) (cr (0 0)) (pms (0 2))
    (sr (2 1))))</pre>

<p id="t237">Tree <a href="#top">237</a>, POV <a href="#k237">237</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k238&quot;, &quot;_self&quot;)'>238</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k237&quot;, &quot;_self&quot;)'>237</text>
  </svg></div>

<pre>(defprotocol ca basic
  (defrole clienta
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (cookiestor locn)
      (request httpreq) (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load cookiestor any)
      (stor cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (defrole clientr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (gen-st (cat &quot;client store&quot; u s cookie)))
  (defrole servera
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load authstor any)
      (stor authstor (cat &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat &quot;server store&quot; s u cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (facts (neq u s))
    (gen-st (cat &quot;server store&quot; s u cookie)))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;servera&quot; z (idx 5)) (p &quot;servera&quot; &quot;s&quot; z s)
          (p &quot;servera&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;s&quot; z s)
          (p &quot;serverr&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie data) (s u name))
      (implies
        (and (p &quot;clientr&quot; z (idx 5)) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;s&quot; z s) (p &quot;clientr&quot; &quot;u&quot; z u))
        (gen-st (cat &quot;client store&quot; u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;cookie&quot; z cookie)
          (p &quot;serverr&quot; &quot;u&quot; z u) (p &quot;serverr&quot; &quot;s&quot; z s))
        (gen-st (cat &quot;server store&quot; s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))</pre>

<p id="k237">Item <a href="#t237">237</a>, Child: <a href="#k238">238</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-0 &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any) (cookie cookie) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <text x='39.960' y='39.960' style='text-anchor: middle;'>ca 237</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (spk akey) (s ca u name)
    (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca)
    (authstor authstor))
  (non-orig (invk spk) (privk ca))
  (uniq-orig cookie sr)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 &quot;server store&quot; s u cookie))
      (recv
        (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))))
  (label 237)
  (realized)
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5)))
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k238">Item <a href="#t237">238</a>, Parent: <a href="#k237">237</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-0 &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any) (cookie cookie) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <text x='39.960' y='39.960' style='text-anchor: middle;'>ca 238</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (spk akey) (s ca u name)
    (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca)
    (authstor authstor))
  (non-orig (invk spk) (privk ca))
  (uniq-orig cookie sr)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 &quot;server store&quot; s u cookie))
      (recv
        (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))))
  (label 238)
  (parent 237)
  (realized)
  (shape)
  (maps
    ((0)
      ((s s) (ca ca) (spk spk) (cr cr) (sr sr) (pms pms) (cookie cookie)
        (u u) (p p) (any any) (authstor authstor) (request request))))
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5))))</pre>

<p id="t239">Tree <a href="#top">239</a>, POV <a href="#k239">239</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k240&quot;, &quot;_self&quot;)'>240</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k239&quot;, &quot;_self&quot;)'>239</text>
  </svg></div>

<pre>(defprotocol ca basic
  (defrole clienta
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (cookiestor locn)
      (request httpreq) (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load cookiestor any)
      (stor cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (defrole clientr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (gen-st (cat &quot;client store&quot; u s cookie)))
  (defrole servera
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load authstor any)
      (stor authstor (cat &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat &quot;server store&quot; s u cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (facts (neq u s))
    (gen-st (cat &quot;server store&quot; s u cookie)))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;servera&quot; z (idx 5)) (p &quot;servera&quot; &quot;s&quot; z s)
          (p &quot;servera&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;s&quot; z s)
          (p &quot;serverr&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie data) (s u name))
      (implies
        (and (p &quot;clientr&quot; z (idx 5)) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;s&quot; z s) (p &quot;clientr&quot; &quot;u&quot; z u))
        (gen-st (cat &quot;client store&quot; u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;cookie&quot; z cookie)
          (p &quot;serverr&quot; &quot;u&quot; z u) (p &quot;serverr&quot; &quot;s&quot; z s))
        (gen-st (cat &quot;server store&quot; s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))</pre>

<p id="k239">Item <a href="#t239">239</a>, Child: <a href="#k240">240</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-0 &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any) (cookie cookie) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <text x='39.960' y='39.960' style='text-anchor: middle;'>ca 239</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (spk akey) (s ca u name)
    (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca)
    (authstor authstor))
  (non-orig (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 &quot;server store&quot; s u cookie))
      (recv
        (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))))
  (label 239)
  (realized)
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5)))
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k240">Item <a href="#t239">240</a>, Parent: <a href="#k239">239</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-0 &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any) (cookie cookie) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <text x='39.960' y='39.960' style='text-anchor: middle;'>ca 240</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr random32) (pms random48) (spk akey) (s ca u name)
    (pt pt-0 pval) (authstor locn))
  (defstrand servera 9 (any any) (cookie cookie) (request request) (p p)
    (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca)
    (authstor authstor))
  (non-orig (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load authstor (cat pt any))
      (stor authstor (cat pt-0 &quot;server store&quot; s u cookie))
      (recv
        (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))))
  (label 240)
  (parent 239)
  (realized)
  (shape)
  (maps
    ((0)
      ((s s) (ca ca) (spk spk) (cr cr) (sr sr) (pms pms) (cookie cookie)
        (u u) (p p) (any any) (authstor authstor) (request request))))
  (origs (pt-0 (0 7)) (sr (0 1)) (cookie (0 5))))</pre>

<p id="t241">Tree <a href="#top">241</a>, POV <a href="#k241">241</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k243&quot;, &quot;_self&quot;)'>243</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k241&quot;, &quot;_self&quot;)'>241</text>
  </svg></div>

<pre>(defprotocol ca basic
  (defrole clienta
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (cookiestor locn)
      (request httpreq) (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load cookiestor any)
      (stor cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (defrole clientr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (gen-st (cat &quot;client store&quot; u s cookie)))
  (defrole servera
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load authstor any)
      (stor authstor (cat &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat &quot;server store&quot; s u cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (facts (neq u s))
    (gen-st (cat &quot;server store&quot; s u cookie)))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;servera&quot; z (idx 5)) (p &quot;servera&quot; &quot;s&quot; z s)
          (p &quot;servera&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;s&quot; z s)
          (p &quot;serverr&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie data) (s u name))
      (implies
        (and (p &quot;clientr&quot; z (idx 5)) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;s&quot; z s) (p &quot;clientr&quot; &quot;u&quot; z u))
        (gen-st (cat &quot;client store&quot; u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;cookie&quot; z cookie)
          (p &quot;serverr&quot; &quot;u&quot; z u) (p &quot;serverr&quot; &quot;s&quot; z s))
        (gen-st (cat &quot;server store&quot; s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))</pre>

<p id="k241">Item <a href="#t241">241</a>, Child: <a href="#k243">243</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(ch-msg authstor (cat pt &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((cookie cookie) (request request) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>serverr</text>
   </g>
  <text x='39.960' y='39.960' style='text-anchor: middle;'>ca 241</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (cookie data) (request httpreq) (cr sr random32) (pms random48)
    (spk akey) (s ca u name) (pt pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))
  (non-orig (invk spk) (privk ca))
  (uniq-orig sr)
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat pt &quot;server store&quot; s u cookie))))
  (label 241)
  (realized)
  (origs (sr (0 1)))
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k243">Item <a href="#t241">243</a>, Parent: <a href="#k241">241</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='264.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 639.960 Q 92.940 639.960 45.960 639.960'
   style='stroke-width: 0.960; stroke: blue; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg authstor (cat pt &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt-0 any))</title>
   <circle style='fill: gray;' cx='139.920' cy='564.960' r='6.000'/></g>
  <path
   d='M 139.920 489.960 Q 92.340 525.660 44.759 561.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;))</title>
   <circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms-0 &quot;server finished&quot; (hash cr-0 sr-0 (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms-0 spk-0) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms-0 spk-0))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))) (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms-0 spk-0) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms-0 spk-0))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>cr-0</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g>
   <title>((any any) (cookie cookie) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0) (u u) (s s) (ca ca-0) (authstor authstor))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <g>
   <title>((cookie cookie) (request request) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>serverr</text>
   </g>
  <text x='89.940' y='39.960' style='text-anchor: middle;'>ca 243</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any mesg) (cookie data) (request httpreq) (p password)
    (cr sr cr-0 sr-0 random32) (pms pms-0 random48) (spk spk-0 akey)
    (s ca u ca-0 name) (pt pt-0 pval) (authstor locn))
  (defstrand serverr 6 (cookie cookie) (request request) (cr cr) (sr sr)
    (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))
  (defstrand servera 8 (any any) (cookie cookie) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk-0) (u u) (s s) (ca ca-0)
    (authstor authstor))
  (precedes ((1 5) (0 4)) ((1 7) (0 5)))
  (non-orig (invk spk) (privk ca))
  (uniq-orig cookie sr)
  (gen-st (cat &quot;server store&quot; s u cookie))
  (facts (neq u s))
  (leads-to ((1 7) (0 5)))
  (rule fact-serverr-neq0 trRl_servera-at-6 trRl_servera-at-7)
  (operation channel-test (added-strand servera 8)
    (ch-msg authstor (cat pt &quot;server store&quot; s u cookie)) (0 5))
  (traces
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat pt &quot;server store&quot; s u cookie)))
    ((recv cr-0)
      (send (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (enc pms-0 spk-0)
          (enc
            (hash pms-0 &quot;client finished&quot;
              (hash cr-0 sr-0
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (enc pms-0 spk-0)))
            (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms-0 &quot;server finished&quot;
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash pms-0 &quot;client finished&quot;
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms-0 spk-0)))
                (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
          (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;)))
      (recv
        (enc &quot;login&quot; u p (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;)))
      (load authstor (cat pt-0 any))
      (stor authstor (cat pt &quot;server store&quot; s u cookie))))
  (label 243)
  (parent 241)
  (realized)
  (shape)
  (maps
    ((0)
      ((s s) (ca ca) (spk spk) (cr cr) (sr sr) (pms pms) (u u)
        (cookie cookie) (authstor authstor) (request request))))
  (origs (cookie (1 5)) (pt (1 7)) (sr (0 1))))</pre>

<p id="t244">Tree <a href="#top">244</a>, POV <a href="#k244">244</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k288&quot;, &quot;_self&quot;)'>288</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k244&quot;, &quot;_self&quot;)'>244</text>
  </svg></div>

<pre>(defprotocol ca basic
  (defrole clienta
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (cookiestor locn)
      (request httpreq) (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load cookiestor any)
      (stor cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (defrole clientr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (gen-st (cat &quot;client store&quot; u s cookie)))
  (defrole servera
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load authstor any)
      (stor authstor (cat &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat &quot;server store&quot; s u cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (facts (neq u s))
    (gen-st (cat &quot;server store&quot; s u cookie)))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;servera&quot; z (idx 5)) (p &quot;servera&quot; &quot;s&quot; z s)
          (p &quot;servera&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;s&quot; z s)
          (p &quot;serverr&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie data) (s u name))
      (implies
        (and (p &quot;clientr&quot; z (idx 5)) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;s&quot; z s) (p &quot;clientr&quot; &quot;u&quot; z u))
        (gen-st (cat &quot;client store&quot; u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;cookie&quot; z cookie)
          (p &quot;serverr&quot; &quot;u&quot; z u) (p &quot;serverr&quot; &quot;s&quot; z s))
        (gen-st (cat &quot;server store&quot; s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))</pre>

<p id="k244">Item <a href="#t244">244</a>, Child: <a href="#k288">288</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='139.920' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt any))</title>
   <circle style='fill: gray;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: red;' cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>cr</title><circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>cookie</title><circle cx='39.960' cy='189.960' r='6.000'/>
   </g>
  <g><title>cookie</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <text x='89.940' y='39.960' style='text-anchor: middle;'>ca 244</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk akey)
    (u s ca name) (pt pt-0 pval) (cookiestor locn))
  (deflistener cookie)
  (defstrand clienta 10 (any any) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cr sr pms)
  (goals
    (forall
      ((any mesg) (cookie data) (response httpdata) (request httpreq)
        (p password) (cr sr random32) (pms random48) (u s ca name)
        (spk akey) (cookiestor locn) (z z-0 strd))
      (implies
        (and (p &quot;clienta&quot; z 10) (p &quot;&quot; z-0 2) (p &quot;clienta&quot; &quot;any&quot; z any)
          (p &quot;clienta&quot; &quot;cookie&quot; z cookie)
          (p &quot;clienta&quot; &quot;response&quot; z response) (p &quot;clienta&quot; &quot;spk&quot; z spk)
          (p &quot;clienta&quot; &quot;request&quot; z request) (p &quot;clienta&quot; &quot;p&quot; z p)
          (p &quot;clienta&quot; &quot;cr&quot; z cr) (p &quot;clienta&quot; &quot;sr&quot; z sr)
          (p &quot;clienta&quot; &quot;pms&quot; z pms) (p &quot;clienta&quot; &quot;u&quot; z u)
          (p &quot;clienta&quot; &quot;s&quot; z s) (p &quot;clienta&quot; &quot;ca&quot; z ca)
          (p &quot;clienta&quot; &quot;cookiestor&quot; z cookiestor) (p &quot;&quot; &quot;x&quot; z-0 cookie)
          (non (invk spk)) (non (privk ca)) (pnon p) (uniq sr)
          (uniq-at cr z 0) (uniq-at pms z 2)) (false))))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (label 244)
  (unrealized (1 1) (1 3) (1 5) (1 9))
  (origs (pt-0 (1 7)) (cr (1 0)) (pms (1 2)))
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k288">Item <a href="#t244">288</a>, Parent: <a href="#k244">244</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='714.960' x2='39.960' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 714.960 Q 192.900 677.460 45.960 714.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc cookie request-0 (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))</title>
   <circle cx='339.840' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms-0 &quot;server finished&quot; (hash cr-0 sr-0 (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms-0 spk-0) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms-0 spk-0))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))) (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms-0 spk-0) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms-0 spk-0))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>cr-0</title><circle cx='339.840' cy='339.960' r='6.000'/>
   </g>
  <path
   d='M 239.880 789.960 Q 192.900 789.960 145.920 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='239.880' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='239.880' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-2 &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='239.880' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt-1 any-0))</title>
   <circle style='fill: gray;' cx='239.880' cy='564.960' r='6.000'/></g>
  <path
   d='M 239.880 489.960 Q 192.900 489.960 145.920 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='239.880' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='239.880' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 192.900 189.960 145.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='789.960' r='6.000'/></g>
  <path
   d='M 139.920 714.960 Q 186.900 714.960 233.880 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='139.920' cy='714.960' r='6.000'/></g>
  <path
   d='M 139.920 639.960 Q 236.880 602.460 333.840 639.960'
   style='stroke-width: 0.960; stroke: blue; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt any))</title>
   <circle style='fill: gray;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 186.900 414.960 233.880 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 186.900 114.960 233.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>cr</title><circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>cookie</title><circle cx='39.960' cy='789.960' r='6.000'/>
   </g>
  <g><title>cookie</title>
   <circle style='fill: blue;' cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>((cookie cookie) (request request-0) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>clientr</text>
   </g>
  <g>
   <title>((any any-0) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <g>
   <title>((any any) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <text
   x='189.900' y='39.960' style='text-anchor: middle;'>ca 288</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request request-0 httpreq) (p password) (cr sr cr-0 sr-0 random32)
    (pms pms-0 random48) (spk spk-0 akey) (u s ca ca-0 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (deflistener cookie)
  (defstrand clienta 10 (any any) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (authstor authstor))
  (defstrand clientr 6 (cookie cookie) (request request-0) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk-0) (u u) (s s) (ca ca-0)
    (cookiestor cookiestor))
  (precedes ((1 0) (2 0)) ((1 2) (2 2)) ((1 4) (2 4)) ((1 7) (3 4))
    ((1 8) (2 8)) ((2 1) (1 1)) ((2 3) (1 3)) ((2 5) (1 5))
    ((2 9) (1 9)) ((3 5) (0 0)))
  (non-orig (invk spk) (privk ca))
  (pen-non-orig p)
  (uniq-orig cookie cr sr pms)
  (gen-st (cat &quot;client store&quot; u s cookie))
  (facts (neq u s))
  (leads-to ((1 7) (3 4)))
  (rule fact-servera-neq0 gen-st-clientr-0 trRl_clienta-at-6
    trRl_clienta-at-7 trRl_servera-at-6 trRl_servera-at-7)
  (operation nonce-test (added-strand clientr 6) cookie (0 0)
    (enc &quot;login-successful&quot; cookie
      (hash (hash pms cr sr) &quot;server_write&quot;))
    (ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie)))
  (traces ((recv cookie) (send cookie))
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((send cr-0)
      (recv (cat sr-0 s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (enc pms-0 spk-0)
          (enc
            (hash pms-0 &quot;client finished&quot;
              (hash cr-0 sr-0
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (enc pms-0 spk-0)))
            (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms-0 &quot;server finished&quot;
            (hash cr-0 sr-0
              (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms-0 spk-0)
              (enc
                (hash pms-0 &quot;client finished&quot;
                  (hash cr-0 sr-0
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms-0 spk-0)))
                (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
          (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;)))
      (load cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send
        (enc cookie request-0
          (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))))
  (label 288)
  (parent 244)
  (realized)
  (shape)
  (satisfies
    (no (fact false) (any any) (cookie cookie) (response response)
      (request request) (p p) (cr cr) (sr sr) (pms pms) (u u) (s s)
      (ca ca) (spk spk) (cookiestor cookiestor) (z 1) (z-0 0)))
  (maps
    ((0 1)
      ((any any) (cookie cookie) (response response) (request request)
        (p p) (cr cr) (sr sr) (pms pms) (u u) (s s) (ca ca) (spk spk)
        (cookiestor cookiestor))))
  (origs (pt-0 (1 7)) (cookie (2 5)) (pt-2 (2 7)) (sr (2 1)) (cr (1 0))
    (pms (1 2))))</pre>

<p id="t350">Tree <a href="#top">350</a>, POV <a href="#k350">350</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k376&quot;, &quot;_self&quot;)'>376</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k350&quot;, &quot;_self&quot;)'>350</text>
  </svg></div>

<pre>(defprotocol ca basic
  (defrole clienta
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (cookiestor locn)
      (request httpreq) (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load cookiestor any)
      (stor cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (defrole clientr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (gen-st (cat &quot;client store&quot; u s cookie)))
  (defrole servera
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load authstor any)
      (stor authstor (cat &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat &quot;server store&quot; s u cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (facts (neq u s))
    (gen-st (cat &quot;server store&quot; s u cookie)))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;servera&quot; z (idx 5)) (p &quot;servera&quot; &quot;s&quot; z s)
          (p &quot;servera&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;s&quot; z s)
          (p &quot;serverr&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie data) (s u name))
      (implies
        (and (p &quot;clientr&quot; z (idx 5)) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;s&quot; z s) (p &quot;clientr&quot; &quot;u&quot; z u))
        (gen-st (cat &quot;client store&quot; u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;cookie&quot; z cookie)
          (p &quot;serverr&quot; &quot;u&quot; z u) (p &quot;serverr&quot; &quot;s&quot; z s))
        (gen-st (cat &quot;server store&quot; s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))</pre>

<p id="k350">Item <a href="#t350">350</a>, Child: <a href="#k376">376</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: red;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title><circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <text x='39.960' y='39.960' style='text-anchor: middle;'>ca 350</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any mesg) (cookie data) (response httpdata) (request httpreq)
    (p password) (cr sr random32) (pms random48) (spk akey)
    (u s ca name) (pt pt-0 pval) (cookiestor locn))
  (defstrand clienta 10 (any any) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (privk ca))
  (uniq-orig cr sr pms)
  (goals
    (forall
      ((z strd) (cookie data) (u s ca name) (cr sr random32)
        (pms random48) (spk akey))
      (implies
        (and (p &quot;clienta&quot; z 10) (p &quot;clienta&quot; &quot;cookie&quot; z cookie)
          (p &quot;clienta&quot; &quot;u&quot; z u) (p &quot;clienta&quot; &quot;s&quot; z s)
          (p &quot;clienta&quot; &quot;spk&quot; z spk) (p &quot;clienta&quot; &quot;ca&quot; z ca)
          (p &quot;clienta&quot; &quot;cr&quot; z cr) (p &quot;clienta&quot; &quot;sr&quot; z sr)
          (p &quot;clienta&quot; &quot;pms&quot; z pms) (non (privk ca)) (non (invk spk))
          (uniq sr) (uniq-at cr z 0) (uniq-at pms z 2))
        (exists ((z0 strd))
          (and (p &quot;servera&quot; z0 10) (p &quot;servera&quot; &quot;cookie&quot; z0 cookie)
            (p &quot;servera&quot; &quot;u&quot; z0 u) (p &quot;servera&quot; &quot;s&quot; z0 s)
            (p &quot;servera&quot; &quot;spk&quot; z0 spk) (uniq-at cookie z0 5)
            (fact neq u s))))))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (label 350)
  (unrealized (0 1) (0 3) (0 5) (0 9))
  (origs (pt-0 (0 7)) (cr (0 0)) (pms (0 2)))
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k376">Item <a href="#t350">376</a>, Parent: <a href="#k350">350</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 789.960 Q 92.940 789.960 45.960 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='139.920' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-2 &quot;server store&quot; s u cookie))</title>
   <circle style='fill: gray;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt-1 any-0))</title>
   <circle style='fill: gray;' cx='139.920' cy='564.960' r='6.000'/></g>
  <path
   d='M 139.920 489.960 Q 92.940 489.960 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='789.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 86.940 714.960 133.920 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt-0 &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt any))</title>
   <circle style='fill: gray;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <path
   d='M 39.960 414.960 Q 86.940 414.960 133.920 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 86.940 264.960 133.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>cr</title><circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((any any-0) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (authstor authstor))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <g>
   <title>((any any) (cookie cookie) (response response) (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <text x='89.940' y='39.960' style='text-anchor: middle;'>ca 376</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p password) (cr sr random32) (pms random48)
    (spk akey) (u s ca name) (pt pt-0 pt-1 pt-2 pval)
    (cookiestor authstor locn))
  (defstrand clienta 10 (any any) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (cookiestor cookiestor))
  (defstrand servera 10 (any any-0) (cookie cookie) (response response)
    (request request) (p p) (cr cr) (sr sr) (pms pms) (spk spk) (u u)
    (s s) (ca ca) (authstor authstor))
  (precedes ((0 0) (1 0)) ((0 2) (1 2)) ((0 4) (1 4)) ((0 8) (1 8))
    ((1 1) (0 1)) ((1 3) (0 3)) ((1 5) (0 5)) ((1 9) (0 9)))
  (non-orig (invk spk) (privk ca))
  (uniq-orig cookie cr sr pms)
  (facts (neq u s))
  (rule fact-servera-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation encryption-test (displaced 2 0 clienta 9)
    (enc cookie request-0 (hash (hash pms cr sr) &quot;client_write&quot;)) (1 8))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt any))
      (stor cookiestor (cat pt-0 &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load authstor (cat pt-1 any-0))
      (stor authstor (cat pt-2 &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (label 376)
  (parent 350)
  (realized)
  (shape)
  (satisfies yes)
  (maps
    ((0)
      ((cookie cookie) (u u) (s s) (ca ca) (cr cr) (sr sr) (pms pms)
        (spk spk) (p p) (any any) (cookiestor cookiestor)
        (request request) (response response))))
  (origs (pt-0 (0 7)) (cookie (1 5)) (pt-2 (1 7)) (sr (1 1)) (cr (0 0))
    (pms (0 2))))</pre>

<p id="t390">Tree <a href="#top">390</a>, POV <a href="#k390">390</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k415&quot;, &quot;_self&quot;)'>415</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k390&quot;, &quot;_self&quot;)'>390</text>
  </svg></div>

<pre>(defprotocol ca basic
  (defrole clienta
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (cookiestor locn)
      (request httpreq) (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (send (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load cookiestor any)
      (stor cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (defrole clientr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (cookiestor locn) (request httpreq)
      (response httpdata))
    (trace (send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (gen-st (cat &quot;client store&quot; u s cookie)))
  (defrole servera
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (p password) (cookie data) (any mesg) (authstor locn)
      (request httpreq) (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc &quot;login&quot; u p (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms cr sr) &quot;server_write&quot;))) (load authstor any)
      (stor authstor (cat &quot;server store&quot; s u cookie))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (uniq-orig cookie)
    (facts (neq u s)))
  (defrole serverr
    (vars (u s ca name) (cr sr random32) (spk akey) (pms random48)
      (cookie data) (authstor locn) (request httpreq)
      (response httpdata))
    (trace (recv cr) (send (cat sr s spk (enc (hash s spk) (privk ca))))
      (recv
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat &quot;server store&quot; s u cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    (facts (neq u s))
    (gen-st (cat &quot;server store&quot; s u cookie)))
  (defgenrule neqRl_indx
    (forall ((x indx)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_strd
    (forall ((x strd)) (implies (fact neq x x) (false))))
  (defgenrule neqRl_mesg
    (forall ((x mesg)) (implies (fact neq x x) (false))))
  (defgenrule scissorsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (leads-to z0 i0 z2 i2))
        (and (= z1 z2) (= i1 i2)))))
  (defgenrule cakeRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (leads-to z0 i0 z1 i1)
          (leads-to z0 i0 z2 i2) (prec z1 i1 z2 i2)) (false))))
  (defgenrule no-interruption
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (leads-to z0 i0 z2 i2) (trans z1 i1)
          (same-locn z0 i0 z1 i1) (prec z0 i0 z1 i1) (prec z1 i1 z2 i2))
        (false))))
  (defgenrule shearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (trans z2 i2)
          (leads-to z0 i0 z1 i1) (same-locn z0 i0 z2 i2)
          (prec z0 i0 z2 i2))
        (or (and (= z1 z2) (= i1 i2)) (prec z1 i1 z2 i2)))))
  (defgenrule invShearsRule
    (forall ((z0 z1 z2 strd) (i0 i1 i2 indx))
      (implies
        (and (trans z0 i0) (trans z1 i1) (same-locn z0 i0 z1 i1)
          (leads-to z1 i1 z2 i2) (prec z0 i0 z2 i2))
        (or (and (= z0 z1) (= i0 i1)) (prec z0 i0 z1 i1)))))
  (defgenrule fact-servera-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;servera&quot; z (idx 5)) (p &quot;servera&quot; &quot;s&quot; z s)
          (p &quot;servera&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule fact-serverr-neq0
    (forall ((z strd) (s u name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;s&quot; z s)
          (p &quot;serverr&quot; &quot;u&quot; z u)) (fact neq u s))))
  (defgenrule trRl_clienta-at-7
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_clienta-at-6
    (forall ((z strd))
      (implies (p &quot;clienta&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule trRl_servera-at-7
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 7)))))
  (defgenrule trRl_servera-at-6
    (forall ((z strd))
      (implies (p &quot;servera&quot; z (idx 8)) (trans z (idx 6)))))
  (defgenrule gen-st-clientr-0
    (forall ((z strd) (cookie data) (s u name))
      (implies
        (and (p &quot;clientr&quot; z (idx 5)) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;s&quot; z s) (p &quot;clientr&quot; &quot;u&quot; z u))
        (gen-st (cat &quot;client store&quot; u s cookie)))))
  (defgenrule gen-st-serverr-0
    (forall ((z strd) (cookie data) (u s name))
      (implies
        (and (p &quot;serverr&quot; z (idx 6)) (p &quot;serverr&quot; &quot;cookie&quot; z cookie)
          (p &quot;serverr&quot; &quot;u&quot; z u) (p &quot;serverr&quot; &quot;s&quot; z s))
        (gen-st (cat &quot;server store&quot; s u cookie)))))
  (lang (random32 atom) (random48 atom) (password atom) (httpreq atom)
    (httpdata atom)))</pre>

<p id="k390">Item <a href="#t390">390</a>, Child: <a href="#k415">415</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk (enc (hash s spk) (privk ca))) (enc pms spk))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: red;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>cr</title><circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((cookie cookie) (response response) (request request) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clientr</text>
   </g>
  <text x='39.960' y='39.960' style='text-anchor: middle;'>ca 390</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (cookie data) (response httpdata) (request httpreq)
    (cr sr random32) (pms random48) (spk akey) (u s ca name) (pt pval)
    (cookiestor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk) (u u) (s s)
    (ca ca) (cookiestor cookiestor))
  (non-orig (invk spk) (privk ca))
  (uniq-orig cr sr pms)
  (goals
    (forall
      ((z strd) (cookie data) (u s ca name) (cr sr random32)
        (pms random48) (spk akey))
      (implies
        (and (p &quot;clientr&quot; z 7) (p &quot;clientr&quot; &quot;cookie&quot; z cookie)
          (p &quot;clientr&quot; &quot;u&quot; z u) (p &quot;clientr&quot; &quot;s&quot; z s)
          (p &quot;clientr&quot; &quot;spk&quot; z spk) (p &quot;clientr&quot; &quot;ca&quot; z ca)
          (p &quot;clientr&quot; &quot;cr&quot; z cr) (p &quot;clientr&quot; &quot;sr&quot; z sr)
          (p &quot;clientr&quot; &quot;pms&quot; z pms) (non (privk ca)) (non (invk spk))
          (uniq sr) (uniq-at cr z 0) (uniq-at pms z 2))
        (exists ((z0 strd))
          (and (p &quot;servera&quot; z0 8) (p &quot;servera&quot; &quot;cookie&quot; z0 cookie)
            (p &quot;servera&quot; &quot;u&quot; z0 u) (p &quot;servera&quot; &quot;s&quot; z0 s)
            (p &quot;servera&quot; &quot;spk&quot; z0 spk) (uniq-at cookie z0 5)
            (fact neq u s))))))
  (traces
    ((send cr) (recv (cat sr s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms spk)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms spk)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms spk)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms spk)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;)))))
  (label 390)
  (unrealized (0 1) (0 3) (0 6))
  (origs (cr (0 0)) (pms (0 2)))
  (comment &quot;Not closed under rules&quot;))</pre>

<p id="k415">Item <a href="#t390">415</a>, Parent: <a href="#k390">390</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='904.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 904.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='339.960' x2='239.880' y2='864.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='864.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 639.960 Q 291.524 712.464 243.207 784.967'
   style='stroke-width: 0.960; stroke: blue; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg authstor (cat pt-1 &quot;server store&quot; s u-0 cookie))</title>
   <circle style='fill: gray;' cx='339.840' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg authstor (cat pt-2 any-0))</title>
   <circle style='fill: gray;' cx='339.840' cy='564.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 242.880 452.460 145.920 489.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms-1 cr-1 sr-1) &quot;server_write&quot;))</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u-0 p-0 (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms-1 &quot;server finished&quot; (hash cr-1 sr-1 (cat s spk-1 (enc (hash s spk-1) (privk ca-1))) (enc pms-1 spk-1) (enc (hash pms-1 &quot;client finished&quot; (hash cr-1 sr-1 (cat s spk-1 (enc (hash s spk-1) (privk ca-1))) (enc pms-1 spk-1))) (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;)))) (hash (hash pms-1 cr-1 sr-1) &quot;server_write&quot;))</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms-1 spk-1) (enc (hash pms-1 &quot;client finished&quot; (hash cr-1 sr-1 (cat s spk-1 (enc (hash s spk-1) (privk ca-1))) (enc pms-1 spk-1))) (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr-1 s spk-1 (enc (hash s spk-1) (privk ca-1)))</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g><title>cr-1</title>
   <circle style='fill: blue;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 864.960 Q 142.920 827.460 45.960 864.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='239.880' cy='864.960' r='6.000'/></g>
  <g>
   <title>(ch-msg authstor (cat pt-1 &quot;server store&quot; s u-0 cookie))</title>
   <circle style='fill: gray;' cx='239.880' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle style='fill: blue;' cx='239.880' cy='714.960' r='6.000'/></g>
  <path
   d='M 239.880 564.960 Q 142.920 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle cx='239.880' cy='564.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='489.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(cat sr s spk-0 (enc (hash s spk-0) (privk ca-0)))</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>cr</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 639.960 Q 92.940 639.960 45.960 639.960'
   style='stroke-width: 0.960; stroke: blue; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg cookiestor (cat pt &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg cookiestor (cat pt-0 any))</title>
   <circle style='fill: gray;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login-successful&quot; cookie (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;login&quot; u p (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms-0 &quot;server finished&quot; (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca))) (enc pms-0 spk) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca))) (enc pms-0 spk))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))) (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(cat (enc pms-0 spk) (enc (hash pms-0 &quot;client finished&quot; (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca))) (enc pms-0 spk))) (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(cat sr-0 s spk (enc (hash s spk) (privk ca)))</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>cr-0</title><circle cx='139.920' cy='114.960' r='6.000'/>
   </g>
  <g>
   <title>(enc response (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='864.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 136.920 677.460 233.880 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(ch-msg cookiestor (cat pt &quot;client store&quot; u s cookie))</title>
   <circle style='fill: gray;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc (hash pms &quot;server finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))) (hash (hash pms cr sr) &quot;server_write&quot;))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <path
   d='M 39.960 489.960 Q 136.920 452.460 233.880 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(cat (enc pms spk-0) (enc (hash pms &quot;client finished&quot; (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0))) (enc pms spk-0))) (hash (hash pms cr sr) &quot;client_write&quot;)))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>(cat sr s spk-0 (enc (hash s spk-0) (privk ca-0)))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <path
   d='M 39.960 339.960 Q 136.920 302.460 233.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>cr</title><circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((any any-0) (cookie cookie) (p p-0) (cr cr-1) (sr sr-1) (pms pms-1) (spk spk-1) (u u-0) (s s) (ca ca-1) (authstor authstor))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>servera</text>
   </g>
  <g>
   <title>((cookie cookie) (response response) (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u-0) (s s) (ca ca-0) (authstor authstor))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>serverr</text>
   </g>
  <g>
   <title>((any any) (cookie cookie) (p p) (cr cr-0) (sr sr-0) (pms pms-0) (spk spk) (u u) (s s) (ca ca) (cookiestor cookiestor))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>clienta</text>
   </g>
  <g>
   <title>((cookie cookie) (response response) (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u) (s s) (ca ca-0) (cookiestor cookiestor))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>clientr</text>
   </g>
  <text
   x='189.900' y='39.960' style='text-anchor: middle;'>ca 415</text>
  </svg></div>

<pre>(defskeleton ca
  (vars (any any-0 mesg) (cookie data) (response httpdata)
    (request httpreq) (p p-0 password)
    (cr sr cr-0 sr-0 cr-1 sr-1 random32) (pms pms-0 pms-1 random48)
    (spk spk-0 spk-1 akey) (u ca u-0 s ca-0 ca-1 name)
    (pt pt-0 pt-1 pt-2 pval) (cookiestor authstor locn))
  (defstrand clientr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u) (s s)
    (ca ca-0) (cookiestor cookiestor))
  (defstrand clienta 8 (any any) (cookie cookie) (p p) (cr cr-0)
    (sr sr-0) (pms pms-0) (spk spk) (u u) (s s) (ca ca)
    (cookiestor cookiestor))
  (defstrand serverr 7 (cookie cookie) (response response)
    (request request) (cr cr) (sr sr) (pms pms) (spk spk-0) (u u-0)
    (s s) (ca ca-0) (authstor authstor))
  (defstrand servera 8 (any any-0) (cookie cookie) (p p-0) (cr cr-1)
    (sr sr-1) (pms pms-1) (spk spk-1) (u u-0) (s s) (ca ca-1)
    (authstor authstor))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 5) (2 4)) ((1 7) (0 4))
    ((2 1) (0 1)) ((2 3) (0 3)) ((2 6) (0 6)) ((3 5) (1 5))
    ((3 7) (2 5)))
  (non-orig (invk spk-0) (privk ca-0))
  (uniq-orig cookie cr sr pms)
  (gen-st (cat &quot;client store&quot; u s cookie)
    (cat &quot;server store&quot; s u-0 cookie))
  (facts (neq u-0 s))
  (leads-to ((1 7) (0 4)) ((3 7) (2 5)))
  (rule fact-serverr-neq0 trRl_clienta-at-6 trRl_clienta-at-7
    trRl_servera-at-6 trRl_servera-at-7)
  (operation channel-test (added-strand servera 8)
    (ch-msg authstor (cat pt-1 &quot;server store&quot; s u-0 cookie)) (2 5))
  (traces
    ((send cr) (recv (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (send
        (cat (enc pms spk-0)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (enc pms spk-0)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms spk-0)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (load cookiestor (cat pt &quot;client store&quot; u s cookie))
      (send (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (recv (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((send cr-0) (recv (cat sr-0 s spk (enc (hash s spk) (privk ca))))
      (send
        (cat (enc pms-0 spk)
          (enc
            (hash pms-0 &quot;client finished&quot;
              (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
                (enc pms-0 spk)))
            (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
      (recv
        (enc
          (hash pms-0 &quot;server finished&quot;
            (hash cr-0 sr-0 (cat s spk (enc (hash s spk) (privk ca)))
              (enc pms-0 spk)
              (enc
                (hash pms-0 &quot;client finished&quot;
                  (hash cr-0 sr-0
                    (cat s spk (enc (hash s spk) (privk ca)))
                    (enc pms-0 spk)))
                (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;))))
          (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;)))
      (send
        (enc &quot;login&quot; u p (hash (hash pms-0 cr-0 sr-0) &quot;client_write&quot;)))
      (recv
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms-0 cr-0 sr-0) &quot;server_write&quot;)))
      (load cookiestor (cat pt-0 any))
      (stor cookiestor (cat pt &quot;client store&quot; u s cookie)))
    ((recv cr) (send (cat sr s spk-0 (enc (hash s spk-0) (privk ca-0))))
      (recv
        (cat (enc pms spk-0)
          (enc
            (hash pms &quot;client finished&quot;
              (hash cr sr
                (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                (enc pms spk-0)))
            (hash (hash pms cr sr) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms &quot;server finished&quot;
            (hash cr sr (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
              (enc pms spk-0)
              (enc
                (hash pms &quot;client finished&quot;
                  (hash cr sr
                    (cat s spk-0 (enc (hash s spk-0) (privk ca-0)))
                    (enc pms spk-0)))
                (hash (hash pms cr sr) &quot;client_write&quot;))))
          (hash (hash pms cr sr) &quot;server_write&quot;)))
      (recv (enc cookie request (hash (hash pms cr sr) &quot;client_write&quot;)))
      (load authstor (cat pt-1 &quot;server store&quot; s u-0 cookie))
      (send (enc response (hash (hash pms cr sr) &quot;server_write&quot;))))
    ((recv cr-1)
      (send (cat sr-1 s spk-1 (enc (hash s spk-1) (privk ca-1))))
      (recv
        (cat (enc pms-1 spk-1)
          (enc
            (hash pms-1 &quot;client finished&quot;
              (hash cr-1 sr-1
                (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                (enc pms-1 spk-1)))
            (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;))))
      (send
        (enc
          (hash pms-1 &quot;server finished&quot;
            (hash cr-1 sr-1
              (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
              (enc pms-1 spk-1)
              (enc
                (hash pms-1 &quot;client finished&quot;
                  (hash cr-1 sr-1
                    (cat s spk-1 (enc (hash s spk-1) (privk ca-1)))
                    (enc pms-1 spk-1)))
                (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;))))
          (hash (hash pms-1 cr-1 sr-1) &quot;server_write&quot;)))
      (recv
        (enc &quot;login&quot; u-0 p-0
          (hash (hash pms-1 cr-1 sr-1) &quot;client_write&quot;)))
      (send
        (enc &quot;login-successful&quot; cookie
          (hash (hash pms-1 cr-1 sr-1) &quot;server_write&quot;)))
      (load authstor (cat pt-2 any-0))
      (stor authstor (cat pt-1 &quot;server store&quot; s u-0 cookie))))
  (label 415)
  (parent 390)
  (realized)
  (shape)
  (satisfies
    (no (p &quot;servera&quot; &quot;u&quot; z0 u) (z 0) (cookie cookie) (u u) (s s)
      (ca ca-0) (cr cr) (sr sr) (pms pms) (spk spk-0)))
  (maps
    ((0)
      ((cookie cookie) (u u) (s s) (ca ca-0) (cr cr) (sr sr) (pms pms)
        (spk spk-0) (cookiestor cookiestor) (request request)
        (response response))))
  (origs (cookie (3 5)) (pt-1 (3 7)) (pt (1 7)) (sr (2 1)) (cr (0 0))
    (pms (0 2))))</pre>

</body>
</html>
